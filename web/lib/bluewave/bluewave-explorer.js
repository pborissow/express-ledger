//Bluewave Explorer 1.0.1
if(!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.CalendarEditor=function(e,t){var a=this,l={panel:{},colors:bluewave.utils.getColorGradients(),chart:{showTooltip:!0}},i=[],o={},n={},s=function(){t||(t={}),l.chart.colors=l.colors.green.map(e=>e).reverse(),t=y(t,l),n=t.chart,r=f(e,{onSettings:function(){n&&c()},onResize:function(){h()},onTitleChange:function(e){n.chartTitle=e}}),a.el=r.el},r,d;this.update=function(e){a.clear();var l={};for(var o in y(l,e.config),y(l,t.chart),n=l,e.inputs)if(e.inputs.hasOwnProperty(o)){var s=e.inputs[o],d=w(s.data,s.config);0<d.length&&i.push(d)}n.chartTitle&&r.setTitle(n.chartTitle),u(r.getLeftPanel()),h()},this.clear=function(){i=[],n={},r.clear()},this.getConfig=function(){return n},this.getChart=function(){return r.getChartArea()},this.renderChart=function(e){var t=new bluewave.charts.CalendarChart(e,{});return h(t),t};var u=function(e){var t=i[0],a=Object.keys(t[0]),l=[],s=[];a.forEach(e=>{var a=[];t.forEach(t=>{var l=t[e];a.push(l)});var i=C(a);"date"==i&&l.push(e),("number"==i||"currency"==i)&&s.push(e)});var r=g(e);r.style.height="",p(r,"Date","date"),p(r,"Value","value"),l.forEach(e=>{o.date.add(e,e)}),s.forEach(e=>{o.value.add(e,e)}),n.date?o.date.setValue(n.date,!1):o.date.setValue(l[0],!1),n.value?o.value.setValue(n.value,!1):o.value.setValue(s[0],!1)},p=function(e,a,l){var i;i=e.addRow().addColumn(),i.innerHTML=a+":",i=e.addRow().addColumn(),o[l]=new javaxt.dhtml.ComboBox(i,{style:t.style.combobox,readOnly:!0}),o[l].clear(),o[l].onChange=function(e,t){n[l]=t,h()}},h=function(e){if(n.date&&n.value){if(e)e.clear();else{var t=r.getChartArea();t.innerHTML="",e=new bluewave.charts.CalendarChart(t,{})}var a=i[0];e.update(n,a)}},c=function(){d||(d=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=d.getBody();e.innerHTML="";var a=bluewave.utils.createColorField({colors:t.colors,style:t.style}),l=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"color",label:"Color",type:a}]},{group:"Labels",items:[{name:"dayLabel",label:"Show Day",type:"checkbox",options:[{label:"",value:!0}]},{name:"yearLabel",label:"Show Year",type:"checkbox",options:[{label:"",value:!0}]}]}]});a.setValue(JSON.stringify(n.colors)),a.getValue()||a.setValue(JSON.stringify(n.colors.map(e=>e).reverse()));var i=l.findField("dayLabel"),o=n.dayLabel;i.setValue(!(!0!==o));var s=l.findField("yearLabel"),r=n.yearLabel;s.setValue(!(!0!==r)),l.onChange=function(){var e=l.getData();e.dayLabel=!("true"!==e.dayLabel),e.yearLabel=!("true"!==e.yearLabel),n.dayLabel=e.dayLabel,n.yearLabel=e.yearLabel,n.colors=JSON.parse(e.color).reverse(),h()},d.showAt(108,57),l.resize()},y=javaxt.dhtml.utils.merge,m=javaxt.dhtml.utils.merge,g=javaxt.dhtml.utils.createTable,b=javaxt.dhtml.utils.createElement,f=bluewave.utils.createEditor,C=bluewave.chart.utils.getType,w=bluewave.utils.parseData;s()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.TreeMapEditor=function(e,t){var a=this,l={panel:{},colors:bluewave.utils.getColorGradients(),chart:{showTooltip:!0,shape:"circle"}},i=[],o={},n={},s=function(){t||(t={}),t=g(t,l),n=t.chart,r=w(e,{onSettings:function(){n&&y()},onResize:function(){c()},onTitleChange:function(e){n.chartTitle=e}}),a.el=r.el},r,d,u;this.update=function(e){a.clear();var l={};for(var o in g(l,e.config),g(l,t.chart),n=l,e.inputs)if(e.inputs.hasOwnProperty(o)){var s=e.inputs[o],d=k(s.data,s.config);0<d.length&&i.push(d)}n.chartTitle&&r.setTitle(n.chartTitle),p(r.getLeftPanel()),c()},this.clear=function(){i=[],n={},r.clear()},this.getConfig=function(){return n},this.getChart=function(){return r.getChartArea()},this.renderChart=function(e){var t=new bluewave.charts.TreeMapChart(e,{});return c(t),t};var p=function(e){var t=i[0],a=Object.keys(t[0]),l=[],s=[],r=[];a.forEach(e=>{var a=[];t.forEach(t=>{var l=t[e];a.push(l)});var i=v(a);"string"==i&&l.push({name:e,values:new Set(a).size}),("number"==i||"currency"==i)&&s.push(e),"string"==i&&r.push(e)});var d=f(e);d.style.height="",h(d,"Key","key"),h(d,"Value","value"),h(d,"Group By","groupBy"),l.sort(function(e,t){return e.values-t.values}),l.forEach(e=>{o.key.add(e.name,e.name)}),s.forEach(e=>{o.value.add(e,e)}),o.groupBy.add("",""),r.forEach(e=>{o.groupBy.add(e,e)}),n.key||(n.key=l[0].name),o.key.setValue(n.key,!0),n.value||(n.value=s[0]),o.value.setValue(n.value,!0),n.groupBy&&o.groupBy.setValue(n.groupBy,!0)},h=function(e,a,l){var i;i=e.addRow().addColumn(),i.innerHTML=a+":",i=e.addRow().addColumn(),o[l]=new javaxt.dhtml.ComboBox(i,{style:t.style.combobox,readOnly:!0}),o[l].onChange=function(e,t){n[l]=t,c()}},c=function(e){if(u&&u.hide(),e)e.clear();else{var t=r.getChartArea();t.innerHTML="",e=new bluewave.charts.TreeMapChart(t,{}),e.getValueLabel=function(e,t){var a=bluewave.chart.utils.parseFloat(e);return isNaN(a)?e:T(b(a,2))},e.onClick=function(t,a){m(e.getGroup(a.group))}}if(n.key&&n.value){var a=i[0];e.update(n,a,function(){if("circle"===n.shape){var t=e.getGroups(),a=Object.keys(t);if(1<a.length){var l=[];a.forEach(e=>{var a=t[e],i=0,o=null;a.forEach(e=>{i+=e.data.value,o||(o=e.rect.style.fill)}),l.push({key:e,value:i,color:o})}),l.sort(function(e,t){return t.value-e.value}),u=x(r.getChartArea()),l.forEach(e=>{u.addItem(e.key,e.color)})}}})}},y=function(){d||(d=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=d.getBody();e.innerHTML="";var a=new javaxt.dhtml.ComboBox(C("div"),{style:t.style.combobox,readOnly:!0});a.add("Circular","circle"),a.add("Rectangular","square");var l=bluewave.utils.createColorField({colors:t.colors,style:t.style}),i=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"shape",label:"Shape",type:a},{name:"color",label:"Color",type:l}]},{group:"Labels",items:[{name:"groupLabel",label:"Show Group",type:"checkbox",options:[{label:"",value:!0}]},{name:"keyLabel",label:"Show Key",type:"checkbox",options:[{label:"",value:!0}]},{name:"valueLabel",label:"Show Value",type:"checkbox",options:[{label:"",value:!0}]}]}]}),o=i.findField("shape"),s=n.shape;"square"===s?(o.setValue("square"),i.showField("groupLabel")):(o.setValue("circle"),i.hideField("groupLabel")),l.setValue(JSON.stringify(n.colors));var r=i.findField("groupLabel"),u=n.groupLabel;r.setValue(!(!0!==u));var p=i.findField("keyLabel"),h=n.keyLabel;p.setValue(!(!0!==h));var y=i.findField("valueLabel"),m=n.valueLabel;y.setValue(!(!0!==m)),i.onChange=function(){var e=i.getData();"circle"===e.shape?i.hideField("groupLabel"):i.showField("groupLabel"),e.groupLabel=!("true"!==e.groupLabel),e.valueLabel=!("true"!==e.valueLabel),e.keyLabel=!("true"!==e.keyLabel),n.groupLabel=e.groupLabel,n.keyLabel=e.keyLabel,n.valueLabel=e.valueLabel,n.shape=e.shape,n.colors=JSON.parse(e.color),c()},d.showAt(108,57),i.resize()},m=function(e){e&&0!=e.length},g=javaxt.dhtml.utils.merge,b=javaxt.dhtml.utils.round,f=javaxt.dhtml.utils.createTable,C=javaxt.dhtml.utils.createElement,w=bluewave.utils.createEditor,x=bluewave.utils.createLegend,v=bluewave.chart.utils.getType,k=bluewave.utils.parseData,T=bluewave.utils.formatNumber;s()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.LineEditor=function(e,t){var a=this,l={panel:{},chart:{}},o=[],s={},r={layers:[]},d=[],u=function(){t||(t={}),t=k(t,l),p=V(e,{onSettings:function(){C()},onResize:function(){f()},onTitleChange:function(e){r.chartTitle=e}}),a.el=p.el},p,h,c;this.update=function(e){a.clear();var l={};for(var n in k(l,e.config),k(l,t.chart),r=l,e.inputs)if(e.inputs.hasOwnProperty(n)){var s=e.inputs[n],d=O(s.data,s.config);0<d.length&&o.push(d)}var u=function(){r.layers.push({line:{fill:{},point:{}}})};if(!r.layers){r.layers=[];for(var h=0;h<o.length;h++)u()}else if(r.layers.length<o.length)for(var c=o.length-r.layers.length,h=c;h<o.length;h++)u();r.chartTitle&&p.setTitle(r.chartTitle),r.showTooltip=!0,m(p.getLeftPanel()),y()},this.clear=function(){o=[],d=[],r={},s={},c&&c.hide(),h&&(h.clear(),h=null),p.clear()},this.getConfig=function(){return r},this.getChart=function(){return p.getChartArea()},this.renderChart=function(e){var t=new bluewave.charts.LineChart(e,{});return f(t),t};var y=function(){for(let a=0;a<o.length;a++){var e=0<a?a+1:"";let l=`xAxis${e}`,i=`yAxis${e}`,n=`group${e}`,d=`label${e}`;s[n].add("","");let u=Object.keys(o[a][0]);if(u.forEach(e=>{s[l].add(e,e),s[i].add(e,e),s[n].add(e,e)}),s[l].setValue(r.layers[a].xAxis,!0),s[i].setValue(r.layers[a].yAxis,!0),r.layers[a].group)s[n].setValue(r.layers[a].group,!1);else{var t=r.layers[a].line.label;t||(t="Series "+(a+1)),s[d].setValue(t,!0)}}f()},m=function(e){for(var a=[],l=0,d;l<o.length;l++)d=0<l?l+1:"",a.push({group:"Series "+(l+1),items:[g("X-Axis"),b(`xAxis${d}`,s),g("Y-Axis"),b(`yAxis${d}`,s),g("Separate By"),b(`group${d}`,s),g("Name"),{name:`label${d}`,label:"",type:"text"}]});var u=L("div",e);u.style.height="100%",u.style.zIndex=1;for(var p=new javaxt.dhtml.Form(u,{style:t.style.form,items:a}),h=p.getGroups(),l=0;l<o.length;l++){var c=0<l?l+1:"",y="label"+c;s[y]=p.findField(y)}p.onChange=function(e,t){var a=!1,l;h.every(function(t){return t.getRows().every(function(i){if(i===e.row){a=!0;var o=t.name,n=parseInt(o.substring(o.lastIndexOf(" ")));l=n-1}return!a}),!a});var i=r.layers[l],o=e.name;["xAxis","yAxis","group","label"].forEach(function(e){var a=o.indexOf(e);o.includes(e)&&("label"==e?i.line.label=t:i[e]=t)});var o=e.name,n=o.indexOf("group");if(-1<n){var s=o.substring(5),d=p.findField("label"+s),u=d.row.previousSibling;d.hide||(T(d.row),T(u)),t?(d.row.hide(),u.hide()):(d.row.show(),u.show()),p.resize()}f()}},g=function(e){var t=L("div","form-label");return t.innerText=e+":",{name:"",label:"",type:{getValue:function(){},setValue:function(){},el:t}}},b=function(e,a){return a[e]=new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox,readOnly:!0}),{name:e,label:"",type:a[e]}},f=function(e){if(e)e.clear();else{var t=p.getChartArea();t.innerHTML="",e=new bluewave.charts.LineChart(t,r),e.onClick=function(t,a){var l=e.getLayers()[a+""].line,i=d[a].layer;x(l,i)},h=e}var a=bluewave.utils.getColorPalette(!0),l=function(t,a,l,i,o){e.addLine(t,a,l,i),d.push({layer:o})},n=r.layers;o.forEach(function(e,t){let i=n[t];if(i.xAxis&&i.yAxis)if(i.group){var o=[],s=d3.group(e,e=>e[i.group]);for(const e of s.keys())o.push({key:e,values:s.get(e)});var r=o.map(function(e){return e.key});o.forEach(function(e,o){var n=e.values;let s=new bluewave.chart.Line;s.setColor(a[o%a.length]),s.setLabel(r[o]),l(s,n,i.xAxis,i.yAxis,t)})}else{i.line||(i.line={});var d=i.line.color;d||(d=a[t%a.length],i.line.color=d);let o=new bluewave.chart.Line(i.line);l(o,e,i.xAxis,i.yAxis,t)}}),e.update()},C=function(){var e=N(t),a=e.getBody();a.innerHTML="";var l=new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox,readOnly:!0});l.add("Linear","linear"),l.add("Logarithmic","logarithmic"),l.setValue("linear");var i=new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox,readOnly:!1});w("x",i);var o=new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox,readOnly:!1});w("y",o);var n=new javaxt.dhtml.Form(a,{style:t.style.form,items:[{group:"General",items:[{name:"scaleOptions",label:"Scaling Options",type:l},{name:"endTags",label:"Display End Tags",type:"checkbox",options:[{label:"",value:!0,checked:!0}]},{name:"accumulate",label:"Accumulate Values",type:"checkbox",options:[{label:"",value:!0,checked:!1}]},{name:"stack",label:"Stack Lines",type:"checkbox",options:[{label:"",value:!0,checked:!1}]}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"xMin",label:"Min Value",type:i},{name:"xTicks",label:"Ticks",type:"text"}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"yMin",label:"Min Value",type:o},{name:"yTicks",label:"Ticks",type:"text"}]}]}),s=n.findField("xGrid"),d=r.xGrid;s.setValue(!(!0!==d));var u=n.findField("yGrid"),p=r.yGrid;u.setValue(!(!0!==p));var h=n.findField("xLabel"),c=r.xLabel;h.setValue(!!c);var y=n.findField("yLabel"),m=r.yLabel;y.setValue(!!m);var g=n.findField("endTags"),b=r.endTags;g.setValue(!(!0!==b));var C=n.findField("stack"),x=r.stackValues;C.setValue(!(!0!==x));var v=n.findField("accumulate"),k=r.accumulateValues;v.setValue(!(!0!==k));var T=n.findField("scaleOptions"),V=r.scaling;T.setValue("logarithmic"===V?"logarithmic":"linear"),E("xTicks",n,"",0,50,1);var D=r.xTicks;isNaN(D)&&(D=10),n.findField("xTicks").setValue(D),E("yTicks",n,"",0,50,1);var O=r.yTicks;isNaN(O)&&(O=10),n.findField("yTicks").setValue(O),n.onChange=function(){var e=n.getData();e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.xLabel=!!e.xLabel,e.yLabel=!!e.yLabel,e.endTags=!("true"!==e.endTags),e.stack=!("true"!==e.stack),e.accumulate=!("true"!==e.accumulate),r.scaling=e.scaleOptions,r.xGrid=e.xGrid,r.yGrid=e.yGrid,r.xLabel=e.xLabel,r.yLabel=e.yLabel,r.endTags=e.endTags,r.stackValues=e.stack,r.accumulateValues=e.accumulate,r.xLabel&&(r.xLabel=r.layers[0].xAxis),r.yLabel&&(r.yLabel=r.layers[0].yAxis),r.xTicks=e.xTicks,r.yTicks=e.yTicks;var t=bluewave.chart.utils.parseFloat(i.getText());isNaN(t)||(r.xMin=t);var a=bluewave.chart.utils.parseFloat(o.getText());isNaN(a)||(r.yMin=a),f()},e.showAt(108,57),n.resize()},w=function(e,t){var a=[],l=r.layers;o.forEach(function(t,o){let i=l[o];i[e+"Axis"]&&t.forEach(t=>{a.push(t[i[e+"Axis"]])})});var i=D(a);if("number"==i||"currency"==i){var s=Number.MAX_VALUE,d=0;a.forEach(e=>{var t=bluewave.chart.utils.parseFloat(e);s=Math.min(t,s),d=Math.max(t,d)}),t.add("0",0),0!=s&&t.add(s+"",s);var u=bluewave.chart.utils.parseFloat(r[e+"Min"]);isNaN(u)?t.setValue(0):(t.add(u+"",u),t.setValue(u))}},x=function(e,a){var l=N(t),i=l.getBody();i.innerHTML="";var o=new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox,readOnly:!0});o.add("Solid","solid"),o.add("Dashed","dashed"),o.add("Dotted","dotted"),o.setValue("solid");var n=new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox,readOnly:!0});n.add("None","none"),n.add("Simple Spline","spline"),n.add("Moving Average","movingAverage"),n.add("Kernel Density Estimation","kde"),n.setValue("none");var s=new javaxt.dhtml.Form(i,{style:t.style.form,items:[{group:"Stroke",items:[{name:"lineStyle",label:"Type",type:o},{name:"lineColor",label:"Color",type:new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox})},{name:"lineThickness",label:"Thickness",type:"text"},{name:"lineOpacity",label:"Opacity",type:"text"}]},{group:"Points",items:[{name:"pointColor",label:"Color",type:new javaxt.dhtml.ComboBox(L("div"),{style:t.style.combobox})},{name:"pointRadius",label:"Radius",type:"text"}]},{group:"Fill",items:[{name:"startOpacity",label:"Start Opacity",type:"text"},{name:"endOpacity",label:"End Opacity",type:"text"}]},{group:"Smoothing",items:[{name:"smoothingType",label:"Type",type:n},{name:"smoothingValue",label:"Factor",type:"text"}]}]});v("lineColor",s),v("pointColor",s);var d=e.getConfig();E("lineThickness",s,"px",1,10,1);var u=d.width;isNaN(u)&&(u=1),s.findField("lineThickness").setValue(u),E("lineOpacity",s,"%");var p=d.opacity;isNaN(p)&&(p=1),s.findField("lineOpacity").setValue(100*p),E("startOpacity",s,"%");var h=d.fill.startOpacity;isNaN(h)&&(h=0),s.findField("startOpacity").setValue(100*h),E("endOpacity",s,"%");var c=d.fill.endOpacity;isNaN(c)&&(c=0),s.findField("endOpacity").setValue(100*c),E("pointRadius",s,"px",0,10,1);var y=d.point.radius;isNaN(y)&&(y=0),s.findField("pointRadius").setValue(y);var m=s.findField("smoothingValue"),g=E("smoothingValue",s,"",0,100,1),b=d.smoothingValue;isNaN(b)&&(b=0),m.setValue(b),s.findField("lineColor").setValue(d.color),s.findField("pointColor").setValue(d.point.color),s.findField("pointRadius").setValue(d.point.radius),s.findField("lineStyle").setValue(d.style),s.findField("lineThickness").setValue(d.width),s.findField("lineOpacity").setValue(100*d.opacity),s.findField("startOpacity").setValue(100*d.fill.startOpacity),s.findField("endOpacity").setValue(100*d.fill.endOpacity);var C=d.smoothing;if(C){s.findField("smoothingType").setValue(C);var b=d.smoothingValue;isNaN(b)&&(b=0),m.setValue(b)}else m.setValue(0),s.disableField("smoothingValue"),g.disabled=!0;s.onChange=function(){let t=s.getData();d.color=t.lineColor,d.style=t.lineStyle,d.width=t.lineThickness,d.opacity=t.lineOpacity/100,d.fill.color=t.lineColor,d.fill.startOpacity=t.startOpacity/100,d.fill.endOpacity=t.endOpacity/100,d.point.color=t.pointColor,d.point.radius=t.pointRadius;var l=t.smoothingType;"none"===l||"spline"===l?(d.smoothing=l,d.smoothingValue=0,s.disableField("smoothingValue"),g.disabled=!0):(d.smoothing=l,d.smoothingValue=t.smoothingValue,s.enableField("smoothingValue"),g.disabled=!1),g.focus(),e.setConfig(d);var i=r.layers[a];i.group||(r.layers[a].line=e.getConfig()),f()},l.showAt(108,57),s.resize()},v=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){c||(c=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;c.showAt(l,i,"right","middle"),c.setColor(e.getValue()),c.onChange=function(t){e.setValue(t)}})},k=javaxt.dhtml.utils.merge,T=javaxt.dhtml.utils.addShowHide,L=javaxt.dhtml.utils.createElement,V=bluewave.utils.createEditor,E=bluewave.utils.createSlider,N=bluewave.utils.getStyleEditor,D=bluewave.chart.utils.getType,O=bluewave.utils.parseData;u()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.HistogramEditor=function(e,t){var a=this,l={panel:{},chart:{}},o=[],s={},r={},d=function(){t||(t={}),t=T(t,l),r=t.chart;let i=V(),o=i.firstChild;var n=document.createElement("tr");o.appendChild(n),e.appendChild(i),a.el=i;var s;s=document.createElement("td"),s.style.height="100%",n.appendChild(s);var d=document.createElement("div");d.className="chart-editor-options",d.style.height="100%",d.style.position="relative",d.style.overflow="hidden",d.style.overflowY="auto",s.appendChild(d),y=document.createElement("div"),y.style.position="absolute",d.appendChild(y),s=document.createElement("td"),s.className="chart-editor-preview",s.style.width="100%",s.style.height="100%",n.appendChild(s);var d=document.createElement("div");d.style.height="100%",d.style.position="relative",d.style.overflow="hidden",s.appendChild(d),u=E(d,{width:"100%",height:"100%",title:"Untitled",settings:!0}),h=u.innerDiv,u.el.className="",u.el.style.position="absolute",D(u.title,function(e){u.title.innerHTML=e,r.chartTitle=e}),u.settings.onclick=function(){x()},c=new bluewave.charts.BarChart(h,{}),c.onClick=function(e,t){v(t)}},u,p,h,c,y,m;this.update=function(e){a.clear();var l={};for(var i in T(l,e.config),T(l,t.chart),r=l,r.barType="histogram",e.inputs)if(e.inputs.hasOwnProperty(i)){var n=e.inputs[i],s=S(n.data,n.config);0<s.length&&o.push(s)}r.chartTitle&&(u.title.innerHTML=r.chartTitle),b(y),g()},this.clear=function(){o=[],r={},s={},u.title.innerHTML="Untitled",y.innerHTML="",c&&c.clear(),m&&m.hide()},this.getConfig=function(){let e=Object.assign({},r);return e},this.getChart=function(){return h},this.renderChart=function(e){var t=new bluewave.charts.BarChart(e,{});return t.update(r,o),t};var g=function(){for(let t=0;t<o.length;t++){var e=0<t?t+1:"";let a=`values${e}`,l=`group${e}`;s[l].add("","");let i=Object.keys(o[t][0]);i.forEach(e=>{s[a].add(e,e),s[l].add(e,e)}),s[a].setValue(r[a],!0),r[l]&&s[l].setValue(r[l],!0)}w()},b=function(e){for(var a=[],l=0,d;l<o.length;l++)d=0<l?l+1:"",a.push({group:"Series "+(0<l?d:1),items:[f("Values"),C(`values${d}`,s),f("Separate By"),C(`group${d}`,s)]});var u=document.createElement("div");u.style.height="100%",u.style.zIndex=1,e.appendChild(u);var p=new javaxt.dhtml.Form(u,{style:t.style.form,items:a});p.onChange=function(e,t){var a=e.name;r[a]=t,w()}},f=function(e){var t=document.createElement("div");return t.className="form-label",t.innerText=e+":",{name:"",label:"",type:{getValue:function(){},setValue:function(){},el:t}}},C=function(e,a){return a[e]=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0}),{name:e,label:"",type:a[e]}},w=function(){L(h,function(){c.update(r,o)})},x=function(){var e=O(t),a=e.getBody();a.innerHTML="";var l=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox,readOnly:!0});l.add("Vertical","vertical"),l.add("Horizontal","horizontal"),l.setValue("vertical");var i=new javaxt.dhtml.Form(a,{style:t.style.form,items:[{group:"General",items:[{name:"layout",label:"Chart Layout",type:l},{name:"legend",label:"Display Legend",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Histogram Options",items:[{name:"binWidth",label:"Bin Width",type:"text"}]}]}),o=i.findField("layout"),n=r.barLayout;o.setValue("horizontal"===n?"horizontal":"vertical");var s=i.findField("xGrid"),d=r.xGrid;s.setValue(!(!0!==d));var u=i.findField("yGrid"),p=r.yGrid;u.setValue(!(!0!==p));var h=i.findField("legend"),c=r.barLegend;h.setValue(!(!0!==c));var y=i.findField("xLabel"),m=r.xLabel;y.setValue(!(!0!==m));var g=i.findField("yLabel"),b=r.yLabel;g.setValue(!(!0!==b)),N("binWidth",i,"",1,100,1);var f=r.binWidth;(isNaN(f)||1>f)&&(f=10),i.findField("binWidth").setValue(f),i.onChange=function(){var e=i.getData();e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.legend=!("true"!==e.legend),e.xLabel=!("true"!==e.xLabel),e.yLabel=!("true"!==e.yLabel),r.barLayout=e.layout,r.barLegend=e.legend,r.xGrid=e.xGrid,r.yGrid=e.yGrid,r.xLabel=e.xLabel,r.yLabel=e.yLabel,r.binWidth=e.binWidth,w()},e.showAt(108,57),i.resize()},v=function(e){var a=O(t),l=a.getBody();l.innerHTML="";var i=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"barColor",label:"Color",type:new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox})},{name:"fillOpacity",label:"Opacity",type:"text"}]}]});k("barColor",i),N("fillOpacity",i,"%");var o=r.fillOpacity;if(isNaN(o)&&(o=1),r.fillOpacity=o,i.findField("fillOpacity").setValue(100*o),null!==e&&void 0!==e){let t=`${e}`;r["barColor"+t]||(r["barColor"+t]="#6699CC"),isNaN(r["fillOpacity"+t])&&(r["fillOpacity"+t]=1),i.findField("barColor").setValue(r["barColor"+t]),i.findField("fillOpacity").setValue(100*r["fillOpacity"+t]),i.onChange=function(){let e=i.getData();r["barColor"+t]=e.barColor,r["fillOpacity"+t]=e.fillOpacity,w()}}a.showAt(108,57),i.resize()},k=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){m||(m=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;m.showAt(l,i,"right","middle"),m.setColor(e.getValue()),m.onChange=function(t){e.setValue(t)}})},T=javaxt.dhtml.utils.merge,L=javaxt.dhtml.utils.onRender,V=javaxt.dhtml.utils.createTable,E=bluewave.utils.createDashboardItem,N=bluewave.utils.createSlider,D=bluewave.utils.addTextEditor,O=bluewave.utils.getStyleEditor,F=bluewave.chart.utils.getType,S=bluewave.utils.parseData;d()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.CsvEditor=function(e,t){var a=this,l={panel:{},data:{hasHeader:!1,sheetName:null}},o=[],n=function(){t||(t={}),t=m(t,l);var i=b(e);p(i.addRow().addColumn()),d=i.addRow().addColumn(),d.style.height="100%",d.className="grid-container-"+new Date().getTime(),h(i.addRow().addColumn()),a.el=i},s,r,d,u;this.clear=function(){o=[],u=null,d.innerHTML="",s.clear(),s.hide(),r.setValue(!1)},this.update=function(n){a.clear();var d={};m(d,n.config),m(d,l.data),t.data=d;var u=!0;if(t.data.hasHeader&&r.setValue(!0,!0),!g(o[0]))for(var p=0,e;p<o.length;p++)e=o[p].name,s.add(e,e);if(t.data.sheetName&&s.setValue(t.data.sheetName,!0),!n.data&&n.file){var h=n.file,y=h.name.toLowerCase(),b=y.lastIndexOf(".");if(-1<b){var f=y.substring(b+1);if("csv"===f||"tab"===f||"tsv"===f){var x=new FileReader;x.onload=function(e){return function(t){var e=t.target.result;o=C(e,{separator:"csv"===f?",":"\t"}),n.data=o,c()}}(h),x.readAsText(h)}else if("xls"===f||"xlsx"===f){var x=new FileReader;x.onload=function(e){return function(t){var e=t.target.result;o=w(e),n.data=o,o.forEach(e=>{s.add(e.name,e.name)}),s.show()}}(h),x.readAsArrayBuffer(h)}else;}}else o=n.data,c()},this.getConfig=function(){return t.data};var p=function(e){var a=document.createElement("div");a.className="panel-toolbar",e.appendChild(a);var l=b(a).addRow(),i;i=l.addColumn(),i.style.width="100%",s=new javaxt.dhtml.ComboBox(i,{style:t.style.combobox,readOnly:!0}),s.onChange=function(e){t.data.hasHeader=!1,t.data.sheetName=e,c()},i=l.addColumn();var a=document.createElement("div");a.style.width="135px",i.appendChild(a);var o=document.createElement("div");o.innerText="Has Header",o.className="toolbar-button-label",o.style.float="left",o.style.padding="0 5px 0 8px",o.style.lineHeight="24px",a.appendChild(o);var n=document.createElement("div");n.style.float="left",a.appendChild(n),r=new javaxt.dhtml.Switch(n),r.setValue(!1),r.onChange=function(){t.data.hasHeader=r.getValue(),c()}},h=function(e){var t=document.createElement("div");t.style.float="right",t.style.width="175px",t.style.padding="0px 16px 8px 0px",e.appendChild(t);var a=document.createElement("input");t.appendChild(a),a.type="range",a.className="dashboard-slider";var l=8,i=14;a.setAttribute("min",9),a.setAttribute("max",i+1),a.onchange=function(){var e=this.value-1;y(e)}},c=function(){if((u=null,d.innerHTML="",!!o)&&0!==o.length){var e=t.data.hasHeader;if(!g(o[0])){var a=t.data.sheetName;if(a)for(var l=0;l<o.length;l++)if(o[l].name===a){var n=o[l];u=f(n.getData(),e,d,t);break}}else u=f(o,e,d,t)}},y=function(e){for(var t="."+d.className,a=document.getElementsByTagName("style"),l=0,o;l<a.length;l++)for(var n=a[l].sheet,s=n.cssRules,r=0,u;r<s.length;r++)if(u=s[r],u.selectorText&&u.selectorText.indexOf(0===t)){n.deleteRule(r),o=a[l];break}o||(o=document.createElement("style"),o.appendChild(document.createTextNode("")),document.head.appendChild(o)),o.sheet.insertRule(t+" .table-header-col, "+t+" .table-col {height: "+2.5*e+"px;line-height: "+2.5*e+"px;font-size: "+e+"px;}",0)},m=javaxt.dhtml.utils.merge,g=javaxt.dhtml.utils.isArray,b=javaxt.dhtml.utils.createTable,f=bluewave.utils.createGrid,C=bluewave.utils.parseCSV,w=bluewave.utils.parseXLS;n()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.BarEditor=function(e,t){var a=this,l={panel:{},chart:{showTooltip:!0}},o=[],s={},r={},d=function(){t||(t={}),t=w(t,l),r=t.chart,t||(t={}),t=w(t,l),u=v(e,{onSettings:function(){b()},onResize:function(){g()},onTitleChange:function(e){r.chartTitle=e}}),a.el=u.el},u,p;this.update=function(e){a.clear();var l={};for(var i in w(l,e.config),w(l,t.chart),r=l,e.inputs)if(e.inputs.hasOwnProperty(i)){var n=e.inputs[i],s=L(n.data,n.config);0<s.length&&o.push(s)}r.chartTitle&&u.setTitle(r.chartTitle),c(u.getLeftPanel()),h()},this.clear=function(){o=[],r={},s={},p&&p.hide(),u.clear()},this.getConfig=function(){let e=Object.assign({},r);return e},this.getChart=function(){return u.getChartArea()},this.renderChart=function(e){var t=new bluewave.charts.BarChart(e,{});return g(t),t};var h=function(){for(let t=0;t<o.length;t++){var e=0<t?t+1:"";let a=`xAxis${e}`,l=`yAxis${e}`,i=`group${e}`;s[i].add("","");let n=Object.keys(o[t][0]);n.forEach(e=>{s[a].add(e,e),s[l].add(e,e),s[i].add(e,e)}),s[a].setValue(r[a],!0),s[l].setValue(r[l],!0),r[i]&&s[i].setValue(r[i],!0)}g()},c=function(e){for(var a=[],l=0,d;l<o.length;l++)d=0<l?l+1:"",a.push({group:"Series "+(0<l?d:1),items:[y("X-Axis"),m(`xAxis${d}`,s),y("Y-Axis"),m(`yAxis${d}`,s),y("Separate By"),m(`group${d}`,s)]});var u=x("div",e,{height:"100%",zIndex:1}),p=new javaxt.dhtml.Form(u,{style:t.style.form,items:a});p.onChange=function(e,t){var a=e.name;r[a]=t,g()}},y=function(e){var t=x("div","form-label");return t.innerText=e+":",{name:"",label:"",type:{getValue:function(){},setValue:function(){},el:t}}},m=function(e,a){return a[e]=new javaxt.dhtml.ComboBox(x("div"),{style:t.style.combobox,readOnly:!0}),{name:e,label:"",type:a[e]}},g=function(e){if(e)e.clear();else{var t=u.getChartArea();t.innerHTML="",e=new bluewave.charts.BarChart(t,{}),e.onClick=function(e,t){f(t)}}e.update(r,o)},b=function(){var e=T(t),a=e.getBody();a.innerHTML="";var l=new javaxt.dhtml.ComboBox(x("div"),{style:t.style.combobox,readOnly:!0});l.add("Vertical","vertical"),l.add("Horizontal","horizontal"),l.setValue("vertical");var i=new javaxt.dhtml.Form(a,{style:t.style.form,items:[{group:"General",items:[{name:"layout",label:"Chart Layout",type:l},{name:"stackValues",label:"Stack Bars",type:"checkbox",options:[{label:"",value:!0,checked:!1}]}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"xTicks",label:"Ticks",type:"text"}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"yTicks",label:"Ticks",type:"text"}]}]}),o=i.findField("layout"),n=r.layout;o.setValue("horizontal"===n?"horizontal":"vertical");var s=i.findField("xGrid"),d=r.xGrid;s.setValue(!(!0!==d));var u=i.findField("yGrid"),p=r.yGrid;u.setValue(!(!0!==p));var h=i.findField("xLabel"),c=r.xLabel;h.setValue(!(!0!==c));var y=i.findField("yLabel"),m=r.yLabel;y.setValue(!(!0!==m));var b=i.findField("stackValues"),f=r.stackValues;b.setValue(!(!0!==f)),k("xTicks",i,"",0,50,1);var C=r.xTicks;isNaN(C)&&(C=10),i.findField("xTicks").setValue(C),k("yTicks",i,"",0,50,1);var w=r.yTicks;isNaN(w)&&(w=10),i.findField("yTicks").setValue(w),i.onChange=function(){var e=i.getData();e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.xLabel=!("true"!==e.xLabel),e.yLabel=!("true"!==e.yLabel),e.stackValues=!("true"!==e.stackValues),r.layout=e.layout,r.xGrid=e.xGrid,r.yGrid=e.yGrid,r.xLabel=e.xLabel,r.yLabel=e.yLabel,r.xTicks=e.xTicks,r.yTicks=e.yTicks,r.stackValues=e.stackValues;var t=r.animationSteps;r.animationSteps=0,g(),r.animationSteps=t},e.showAt(108,57),i.resize()},f=function(e){var a=T(t),l=a.getBody();l.innerHTML="";var i=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"barColor",label:"Color",type:new javaxt.dhtml.ComboBox(x("div"),{style:t.style.combobox})},{name:"fillOpacity",label:"Opacity",type:"text"}]},{group:"Border",items:[{name:"borderRadius",label:"Radius",type:"text"}]}]});C("barColor",i),k("fillOpacity",i,"%"),k("borderRadius",i,"",0,50,1);var o=r.borderRadius;if(isNaN(o)&&(o=0),i.findField("borderRadius").setValue(o),null!==e&&void 0!==e){let t=`${e}`;var s=r["barColor"+t];s||(s="#6699CC"),r["barColor"+t]=s,i.findField("barColor").setValue(s);var d=r["fillOpacity"+t];isNaN(d)&&(d=1),r["fillOpacity"+t]=d,i.findField("fillOpacity").setValue(100*d),i.onChange=function(){let e=i.getData();r["barColor"+t]=e.barColor,r["fillOpacity"+t]=e.fillOpacity/100,r.borderRadius=e.borderRadius,g()}}a.showAt(108,57),i.resize()},C=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){p||(p=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;p.showAt(l,i,"right","middle"),p.setColor(e.getValue()),p.onChange=function(t){e.setValue(t)}})},w=javaxt.dhtml.utils.merge,x=javaxt.dhtml.utils.createElement,v=bluewave.utils.createEditor,k=bluewave.utils.createSlider,T=bluewave.utils.getStyleEditor,L=bluewave.utils.parseData;d()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.FilterEditor=function(parent,config){var me=this,defaultConfig={supportedLanguages:["sql","javascript"],style:{border:"1px solid #b5b5b5",editor:{height:"240px"},bottomPanel:{backgroundColor:"#e4e4e4",borderTop:"1px solid #b5b5b5"}},filter:{mode:"sql",code:""}},inputData=[],data=[],button={},init=function(){config||(config={}),config=merge(config,defaultConfig);var e=createTable(parent),t;createToolbar(e.addRow().addColumn());var t=e.addRow().addColumn();setStyle(t,config.style.editor),t.style.borderBottom=config.style.border,createEditor(t);var a=t,t=e.addRow().addColumn();setStyle(t,config.style.bottomPanel),t.style.height="100%",t.style.verticalAlign="top",addVerticalResizer(t,a),createGridContainer(t),createWaitMask(t),me.el=e},editor,combobox,waitmask,gridContainer,grid,getRecords;this.getConfig=function(){return config.filter},this.getData=function(e){e&&e.apply(me,[data])},this.clear=function(){inputData=[],data=[],grid=null,gridContainer.innerHTML=""},this.update=function(e,t){for(var a in me.clear(),config.filter=merge(e.config,defaultConfig.filter),e.inputs)if(e.inputs.hasOwnProperty(a)){var l=e.inputs[a],i=parseData(l.data,l.config);0<i.length&&inputData.push({raw:l.data,data:i,config:l.config})}combobox.setValue(config.filter.mode,!0),editor.setMode(config.filter.mode);var o=config.filter.code,n=getDefaultCode(combobox.getValue());o?(o+="",0==o.trim().length&&(o=n)):o=n,editor.setValue(o),runScript(t)};var createToolbar=function(e){var t=document.createElement("div");t.className="panel-toolbar",e.appendChild(t);var a=createTable(t);a.style.width="";var l=a.addRow(),i;i=l.addColumn(),button.run=createButton(i,{style:config.style.toolbarButton,icon:"fas fa-play",label:"Run"}),button.run.onClick=runScript,i=l.addColumn(),i.style.verticalAlign="bottom",createSpacer(i),i=l.addColumn(),i.innerText="Mode:",i=l.addColumn(),i.style.width="150px",i.style.paddingLeft="5px",combobox=new javaxt.dhtml.ComboBox(i,{style:config.style.combobox,readOnly:!0}),config.supportedLanguages.forEach(e=>{var t;t="sql"===e?e.toUpperCase():e.substring(0,1).toUpperCase()+e.substring(1),combobox.add(t,e)}),combobox.onChange=function(e,t,a,l){var i=editor.getValue(),o=getDefaultCode(l);i===o?(editor.setMode(t),editor.setValue(getDefaultCode(t))):confirm("Are you sure you want to delete this code and switch editor?",{leftButton:{label:"Yes",value:!0},rightButton:{label:"No",value:!1},callback:function(e){e?(editor.setMode(t),editor.setValue(getDefaultCode(t)),gridContainer.innerHTML=""):combobox.setValue(l,!0)}})}},createEditor=function(e){if("undefined"!=typeof CodeMirror){var t=document.createElement("div");t.style.height="100%",t.style.position="relative",e.appendChild(t);var a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.overflow="auto",t.appendChild(a);var l=function(){editor=CodeMirror(a,{value:"",mode:config.filter.mode,lineNumbers:!1,indentUnit:4}),editor.setValue=function(e){var t=this.getDoc();t.setValue(e),t.clearHistory();var a=this;setTimeout(function(){a.refresh()},200)},editor.getValue=function(){return this.getDoc().getValue()},editor.setMode=function(e){if(e!==editor.getOption("mode")){config.filter.mode=e;var t=editor.getValue();editor=null,a.innerHTML="",l(),editor.setValue(t)}}};l()}else editor=document.createElement("textarea"),editor.style.height="100%",editor.style.width="100%",editor.style.resize="none",e.appendChild(editor),editor.getValue=function(){return this.value},editor.setValue=function(e){this.value=e},editor.setMode=function(){}},createGridContainer=function(e){gridContainer=document.createElement("div"),gridContainer.className="grid-container-"+new Date().getTime(),gridContainer.style.height="100%",e.appendChild(gridContainer)},addVerticalResizer=function(e,t){var a=document.createElement("div");a.style.position="relative";var l=document.createElement("div");l.style.position="absolute",l.style.width="100%",l.style.height="10px",l.style.top="-5px",l.style.cursor="ns-resize",l.style.zIndex=2,a.appendChild(l),e.appendChild(a),javaxt.dhtml.utils.initDrag(l,{onDragStart:function(e,a){var l=this;l.yOffset=a,l.initialHeight=t.offsetHeight},onDrag:function(e,a){var l=this,i=l.yOffset-a,o=l.initialHeight-i;t.style.height=o+"px"},onDragEnd:function(){}})},createWaitMask=function(e){waitmask=javaxt.express?new javaxt.express.WaitMask(e):{show:function(){},hide:function(){}}},getDefaultCode=function(e){return"sql"==e?"select * from ?":"javascript"==e?"var records = [];\ndata.forEach((record, i)=>{\n    \n    //TODO: do something with the record\n    \n    records.push(record);\n});\nreturn records;":void 0},runScript=function(callback){gridContainer.innerHTML="";var mode=combobox.getValue(),code=editor.getValue(),input=inputData[0];waitmask.show(),setTimeout(()=>{var arr;if("sql"===mode)arr=alasql(code,[input.data]);else if("javascript"===mode){getRecords=null;var fn="getRecords = function(data){\n"+code+"\n}";eval(fn),arr=getRecords(input.data)}if(waitmask.hide(),arr&&(data=[],0<arr.length)){var keys=Object.keys(arr[0]);data.push(keys),arr.forEach(e=>{var t=[];keys.forEach(a=>{t.push(e[a])}),data.push(t)}),createGrid(data,!0,gridContainer,config)}config.filter.code=code,config.filter.hasHeader=input.config.hasHeader,config.filter.sheetName=input.config.sheetName,callback&&callback.apply(me,[data,config.filter])},300)},merge=javaxt.dhtml.utils.merge,setStyle=javaxt.dhtml.utils.setStyle,createTable=javaxt.dhtml.utils.createTable,createButton=bluewave.utils.createButton,createSpacer=bluewave.utils.createSpacer,createGrid=bluewave.utils.createGrid,parseData=bluewave.utils.parseData;init()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.MapEditor=function(e,t){var a=this,l={panel:{},colors:bluewave.utils.getColorGradients(),chart:{style:{backgroundColor:"#fff",landColor:"#dedde0"}},data:{politicalBoundaries:"data/"}},i={},o=[],n={},s=[],r=function(){t||(t={}),t=G(t,l),i=t.chart,d=U(e,{onSettings:function(){i&&C(i.mapType,i.mapLevel)},onResize:function(){},onTitleChange:function(e){i.chartTitle=e}}),a.el=d.el;let o=_("div",d.getLeftPanel());g(o,"mapType","Map Type",b),g(o,"mapLevel","Map Level",b),g(o,"pointData","Point Data",b),g(o,"latitude","Latitude",f,"lat"),g(o,"longitude","Longitude",f,"long"),g(o,"mapLocation","Location Data",f),g(o,"mapValue","Value",f),g(o,"mapProjectionName","Projection",f);var n=d.getChartArea();n.innerHTML="",u=new bluewave.charts.MapChart(n,i),u.disablePan()},d,u,p,h,c,y,m;this.clear=function(){if(o=[],i={},d.setTitle("Untitled"),n)for(var e in n)if(n.hasOwnProperty(e)){var t=n[e];t&&(t.clear&&t.clear(),t.hide&&t.hide())}u&&u.clear()},this.update=function(e){a.clear();var l={};for(var s in G(l,e.config),G(l,t.chart),i=l,e.inputs)if(e.inputs.hasOwnProperty(s)){var r=e.inputs[s],u=X(r.data,r.config);if(0<u.length)o.push(u);else{var p=r.config;p&&o.push(p)}}i.chartTitle&&d.setTitle(i.chartTitle),i.mapLevel=w(i);var u=o[0];if(I(u)){var h=[],c=[];Object.keys(u[0]).forEach(e=>{var t=[];u.forEach(a=>{var l=a[e];t.push(l)});var a=j(t);"string"==a&&c.push(e),"number"==a&&h.push(e)}),h.forEach(e=>{n.lat.add(e,e),n.long.add(e,e),n.mapValue.add(e,e)}),c.forEach(e=>{n.mapLocation.add(e,e)}),n.mapType.add("Point","Point"),n.mapType.add("Area","Area"),n.pointData.add("Geographic Coordinates","geoCoords"),n.pointData.add("Admin Area","adminArea"),n.mapLevel.add("States","counties"),n.mapLevel.add("Country","states"),n.mapLevel.add("World","world")}else i.mapType="Links",i.mapValue="quantity",i.mapLevel="world",n.mapType.add("Links","Links"),n.mapValue.add("quantity","quantity"),n.mapLevel.add("Country","states"),n.mapLevel.add("World","world");n.mapType.show(),n.mapLevel.show(),n.mapValue.show(),"Point"===i.mapType&&(n.pointData.show(),"geoCoords"===i.pointData&&i.latitude&&i.longitude&&(n.lat.show(),n.long.show())),n.mapType.setValue(i.mapType,!1),n.mapLevel.setValue(i.mapLevel,!0),n.mapValue.setValue(i.mapValue,!0),n.pointData.setValue(i.pointData,!0),n.lat.setValue(i.latitude,!0),n.long.setValue(i.longitude,!0),f()},this.resize=function(){u&&u.resize()};var g=function(e,a,l,o,s){s||(s=a);var r=_("div",e);W(r);var d=_("label",r);d.innerText=l+":";var u=new javaxt.dhtml.ComboBox(r,{style:t.style.combobox,readOnly:!0});u.onChange=function(e,t){i[a]=t;var l=[];o===b&&(l=[s,e,t]),o.apply(u,l)};var p=u.show;u.show=function(){p(),r.show()};var h=u.hide;u.hide=function(){h(),r.hide()},u.hide(),n[s]=u},b=function(e,t,a){"mapType"===e?"Point"===a?(n.mapLocation.hide(),n.mapValue.show(),n.pointData.show()):"Area"==a&&(n.lat.hide(),n.long.hide(),n.mapLocation.show(),n.mapValue.show(),n.pointData.hide()):"pointData"===e?"geoCoords"===a?(n.lat.show(),n.long.show(),n.mapLocation.hide()):"adminArea"==a&&(n.lat.hide(),n.long.hide(),n.mapLocation.show()):"mapLevel"==e&&(delete i.lon,delete i.lat,f())},f=function(e){i.mapType&&i.mapLevel&&("Point"!==i.mapType||null!==i.pointData)&&("Point"!==i.mapType||"geoCoords"!==i.pointData||null!==i.latitude&&null!==i.longitude&&null!==i.mapValue)&&("Point"!==i.mapType||"adminArea"!==i.pointData||null!==i.mapLocation&&null!==i.mapValue)&&("Area"!==i.mapType||null!==i.mapValue&&null!==i.mapLocation)&&("Links"!==i.mapType||null!=i.mapValue&&null!==i.mapLocation)&&B(()=>{e instanceof bluewave.charts.MapChart||(e=u),k(e,o[0])})};this.getConfig=function(){return i},this.getChart=function(){return d.getChartArea()},this.renderChart=function(e){var t=new bluewave.charts.MapChart(e,i);return f(t),t};var C=function(e,a){p||(p=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var l=p.getBody(),o;l.innerHTML="";var n={group:"Map Colors",items:[{name:"backgroundColor",label:"Background",type:new javaxt.dhtml.ComboBox(_("div"),{style:t.style.combobox})},{name:"landColor",label:"Land",type:new javaxt.dhtml.ComboBox(_("div"),{style:t.style.combobox})}]},s={group:"Map Center",items:[{name:"centerHorizontal",label:"Longitude",type:"text"},{name:"centerVertical",label:"Latitude",type:"text"}]};if("Point"===e){var r=[{group:"Point Style",items:[{name:"color",label:"Color",type:new javaxt.dhtml.ComboBox(_("div"),{style:t.style.combobox})},{name:"radius",label:"Radius",type:"text"},{name:"opacity",label:"Opacity",type:"text"},{name:"outlineWidth",label:"Border Width",type:"text"},{name:"outlineColor",label:"Border Color",type:new javaxt.dhtml.ComboBox(_("div"),{style:t.style.combobox})}]},n];"states"!==a&&"world"!==a,o=new javaxt.dhtml.Form(l,{style:t.style.form,items:r}),v("color",o),v("backgroundColor",o),v("landColor",o);var d=i.pointColor||"#ff3c38";o.findField("color").setValue(d),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor),v("outlineColor",o),o.findField("outlineColor").setValue(i.outlineColor||d),q("radius",o,"px",1,20,1);var u=i.pointRadius;null==u&&(u=3),i.pointRadius=u,o.findField("radius").setValue(u),q("opacity",o,"%");var h=i.opacity;null==h&&(h=100),i.opacity=h,o.findField("opacity").setValue(h),q("outlineWidth",o,"px",0,20,1);var c=i.outlineWidth;if(null==c&&(c=0),i.outlineWidth=c,o.findField("outlineWidth").setValue(c),"states"===a||"world"===a){var y=o.findField("centerHorizontal");if(y){var m=i.lon;null==m&&("states"===a?m=38.7:m=39.5),i.lon=m,y.setValue(m)}var g=o.findField("centerVertical");if(g){var b=i.lat;null==b&&("states"===a?b=-.6:b=-98.5),i.lat=b,g.setValue(b)}o.onChange=function(){var e=o.getData();i.pointColor=e.color,i.outlineColor=e.outlineColor,i.pointRadius=e.radius,i.opacity=e.opacity,i.outlineWidth=e.outlineWidth,i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,i.lon=e.centerHorizontal,i.lat=e.centerVertical,f()}}else o.onChange=function(){var e=o.getData();i.pointColor=e.color,i.outlineColor=e.outlineColor,i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,i.pointRadius=e.radius,i.outlineWidth=e.outlineWidth,i.opacity=e.opacity,f()}}else if("Area"===e){if("states"===a||"world"===a){o=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"fillColors",label:"Color",type:x()}]},n]}),v("backgroundColor",o),v("landColor",o),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor);var y=o.findField("centerHorizontal");if(y){var m=i.lon;null==m&&("states"===a?m=38.7:m=39.5),i.lon=m,y.setValue(m)}var g=o.findField("centerVertical");if(g){var b=i.lat;null==b&&("states"===a?b=-.6:b=-98.5),i.lat=b,g.setValue(b)}o.onChange=function(){var e=o.getData();i.fillColors=JSON.parse(e.fillColors),i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,i.lon=e.centerHorizontal,i.lat=e.centerVertical,f()}}else"counties"===a&&(o=new javaxt.dhtml.Form(l,{style:t.style.form,items:[{group:"Fill Style",items:[{name:"fillColors",label:"Color",type:x()}]},n]}),v("backgroundColor",o),v("landColor",o),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor),o.onChange=function(){var e=o.getData();i.fillColors=JSON.parse(e.fillColors),i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,f()});}else if("Links"===e&&("states"===a||"world"===a)){o=new javaxt.dhtml.Form(l,{style:t.style.form,items:[n]}),v("backgroundColor",o),v("landColor",o),o.findField("backgroundColor").setValue(i.style.backgroundColor),o.findField("landColor").setValue(i.style.landColor);var y=o.findField("centerHorizontal");if(y){var m=i.lon;null==m&&("states"===a?m=38.7:m=39.5),i.lon=m,y.setValue(m)}var g=o.findField("centerVertical");if(g){var b=i.lat;null==b&&("states"===a?b=-.6:b=-98.5),i.lat=b,g.setValue(b)}o.onChange=function(){var e=o.getData();i.lon=e.centerHorizontal,i.lat=e.centerVertical,i.style.landColor=e.landColor,i.style.backgroundColor=e.backgroundColor,f()}}o&&(p.showAt(108,57),o.resize())},w=function(e){if(!e.mapLevel)return null;var t=e.mapLevel.toLowerCase();return-1<t.indexOf("census")?"states":-1<t.indexOf("states")?"states":-1<t.indexOf("counties")?"counties":-1<t.indexOf("countries")||-1<t.indexOf("world")?"world":t},x=function(){var e=bluewave.utils.createColorField({colors:t.colors,style:t.style}),a=P();return e.setValue(JSON.stringify(a)),e},v=function(e,a){bluewave.utils.createColorOptions(e,a,function(a){h||(h=bluewave.utils.createColorPickerCallout({style:t.style}));var l;l="backgroundColor"===e?["#fff","#e5ecf4"]:"landColor"===e?["#f6f8f5","#dedde0"]:bluewave.utils.getColorPalette(!0),h.setColors(l),h.setColor(a.getValue());var i=javaxt.dhtml.utils.getRect(a.row),o=i.x+i.width+15,n=i.y+i.height/2;h.showAt(o,n,"right","middle"),h.onChange=function(e){a.setValue(e)}})},k=function(e,t){e.clear();var a=i.style.backgroundColor;a||(a="white"),e.setBackgroundColor(a);var l=R(),o=d3.extent(t,function(e){return parseFloat(e[i.mapValue])}),n;"Area"===i.mapType&&(n=P());var s=i.mapLevel;if("counties"===s){if(e.setProjection("AlbersUsa"),"Point"===i.mapType){D(),O();var r={};"geoCoords"===i.pointData?r=L(t,i):"adminArea"===i.pointData&&(r=V(t,y)),E(r,i,o)}else if("Area"===i.mapType){var d=N(t,i);"counties"===d?(D(t,n,l),O()):"states"===d?O(t,n,l):"censusDivisions"===d?F(t,n,l):(D(),O())}}else if("states"===s){if(e.setProjection("Albers"),e.setExtent([-130,40.5],[-65,25.8]),S(),"Point"===i.mapType){O();var r={};"geoCoords"===i.pointData?r=L(t,i):"adminArea"===i.pointData&&(r=V(t,y)),E(r,i,o)}else if("Area"===i.mapType){var d=N(t,i);"counties"===d?(D(t,n,l),O()):"states"===d?O(t,n,l):"censusDivisions"===d?F(t,n,l):O()}else"Links"===i.mapType&&M("PortsOfEntry",function(a){e.clear(),S(),T(t,a)});}else if("world"===s)if(e.setProjection("Mercator"),e.setExtent([-170,76],[170,-76]),"Point"===i.mapType){S();var r={};"geoCoords"===i.pointData?r=L(t,i):"adminArea"===i.pointData&&(r=V(t,m)),E(r,i,o)}else if("Area"===i.mapType){var u=new z(t,n);e.addPolygons(m.features,{name:"countries",style:{fill:function(e){return u.getColor(e.properties.code,l)},stroke:"white"},showTooltip:!0,getTooltipLabel:function(e){var t=e.properties.name,a=u.getValue(e.properties.code);return isNaN(a)&&(a="No data"),t+": "+a}})}else"Links"===i.mapType&&M("PortsOfEntry",function(a){e.clear(),S(),T(t,a)});e.update()},T=function(e,t){var a=d3.scaleOrdinal(bluewave.utils.getColorPalette(!0)),l=[],o=[],n={},s=function(e,t){for(var a=0,l;a<t.features.length;a++)if(l=t.features[a].properties,e===l.code)return[l.longitude,l.latitude]};for(var r in e.links)if(e.links.hasOwnProperty(r)){var d=r.split("->"),p=e.nodes[d[0]],h=e.nodes[d[1]],c=e.links[r].quantity;if("US"===p.country?l.push(s(p.state,y)):l.push(s(p.country,m)),"US"!==p.country&&"US"===h.country)for(var g=0,b;g<t.length;g++)if(b=t[g],p.country===t[g].iso2){l.push([b.exlongitude,b.exlatitude]),l.push([b.imlongitude,b.imlatitude]);break}"US"===h.country?l.push(s(h.state,y)):l.push(s(h.country,m)),o.push(c),n[p.country]=!0,n[h.country]=!0}n.US?(n=Object.keys(n),1===n.length&&"US"===n[0]?u.setExtent([-130,50.5],[-65,25.8]):u.setExtent([60,74],[59,-58])):u.setExtent([-170,76],[170,-76]),u.addLines([l],{name:"links",style:{color:"steelblue",opacity:.5,width:3}}),u.addPoints(l,{name:"nodes",style:{fill:"#FF0000",opacity:.5,radius:4}}),u.update()},L=function(e,t){var a=[],l=!1;return e.forEach(function(e){var i=parseFloat(e[t.latitude]),o=parseFloat(e[t.longitude]);if(!(isNaN(i)||isNaN(o))){var n=[o,i];if(n&&!(isNaN(n[0])||isNaN(n[1]))){var s=parseFloat(e[t.mapValue]);isNaN(s)||(n.push(s),l=!0),a.push(n)}}}),{coords:a,hasValue:l}},V=function(e,t){var a=[],l=!1;return e.forEach(function(e){var o=e[i.mapLocation];t.features.every(function(t){var n=t.properties;if(o===n.code){var s;if(s=isNaN(n.latitude)||isNaN(n.longitude)?u.getCentroid(t):[n.longitude,n.latitude],s&&(isNaN(s[0])||isNaN(s[0])?s=null:a.push(s)),s&&i.mapValue){var r=parseFloat(e[i.mapValue]);isNaN(r)||(l=!0,s.push(r))}return!1}return!0})}),{coords:a,hasValue:l}},E=function(e,t,a){var l=t.opacity;l?l/=100:l=1;var i=parseInt(t.pointRadius);isNaN(i)&&(i=3),0>i&&(i=1);var o=t.pointColor||"#ff3c38",n=t.outlineColor;n||(n=o);var s=parseFloat(t.outlineWidth);(isNaN(s)||0>s)&&(s=0),s>i&&(s=i),u.addPoints(e.coords,{name:"points",style:{fill:o,opacity:l,radius:function(t){if(e.hasValue){var l=t[2];if(isNaN(l)||0>=l)return i;var o=l/a[1],n=i;return 0<o?n*o:.25*n}return i},outlineWidth:s,outlineColor:n}})},N=function(e,t){var a=0,l=0,i=0;e.forEach(function(e){var o=e[t.mapLocation];if("undefined"!=typeof o){var n=A(e[t.mapLocation]);c.features.every(function(e){return e.id!==o||(l++,!1)}),y.features.every(function(e){var t=!1;return(e.properties.name===o||e.properties.code===o)&&(a++,t=!0),isNaN(n)||e.properties.censusDivision!==n||(i++,t=!0),!t})}});var o=Math.max(a,l,i);if(0<o){if(o===l)return"counties";if(o===a)return"states";if(o===i)return"censusDivisions"}return null},D=function(e,t,a){a||(a=R());var l;e&&t&&(l=new z(e,t)),u.addPolygons(c.features,{name:"counties",style:{fill:function(e){return l?l.getColor(e.id,a):a},stroke:"white"},showTooltip:!!l,getTooltipLabel:function(e){var t=e.id,a=l.getValue(e.id);return isNaN(a)&&(a="No data"),t+": "+a}})},O=function(e,t,a){a||(a=R());var l;e&&t&&(l=new z(e,t)),u.addPolygons(y.features,{name:"states",style:{fill:function(e){if(l){var t=e.properties.name,i=l.getValue(t);return isNaN(i)&&(t=e.properties.code,i=l.getValue(t)),l.getColor(t,a)}return a},stroke:"white"},showTooltip:!!l,getTooltipLabel:function(e){var t=e.properties.name,a=l.getValue(e.properties.name);return isNaN(a)&&(a="No data"),t+": "+a}})},F=function(e,t,a){a||(a=R());var l;e&&t&&(l=new z(e,t));var o={};e.forEach(function(e){var t=A(e[i.mapLocation]);isNaN(t)||(o[t+""]=e[i.mapValue])}),u.addPolygons(y.features,{name:"censusRegions",style:{fill:function(e){var t=parseFloat(o[e.properties.censusDivision+""]);(isNaN(t)||0>t)&&(t=0);var a=colorScale[i.colorScale](t);return a?a:"none"},stroke:"white"},showTooltip:!!l})},S=function(){u.addPolygons(m.features,{name:"countries",style:{fill:i.landColor,stroke:"white"}})},A=function(e){if("undefined"==typeof e)return null;var t=parseInt(t);return isNaN(t)?(e=e.toLowerCase(),-1<e.indexOf("new england")?1:-1<e.indexOf("middle atlantic")||-1<e.indexOf("mid atlantic")?2:-1<e.indexOf("east north central")?3:-1<e.indexOf("west north central")?4:-1<e.indexOf("south atlantic")?5:-1<e.indexOf("east south central")?6:-1<e.indexOf("west south central")?7:-1<e.indexOf("mountain")?8:-1<e.indexOf("pacific")?9:null):t},B=function(e){var a=t.data.politicalBoundaries;bluewave.utils.getMapData(a,function(t){c=t.counties,y=t.states,m=t.countries,e()})},M=function(e,t){bluewave.data||(bluewave.data={}),bluewave.data[e]?t.apply(this,[bluewave.data[e]]):bluewave.utils.getData(e,t)},H=function(e,t,a){for(var l=0;l<a.length-1;l++){var o=a[l],n=a[l+1],s=t[l];if(e>=o&&e<n)return s;if(e==a[a.length-1])return t[t.length-1]}},P=function(){var e=i.fillColors;if(!e&&t.colors&&(e=t.colors.red,!e))for(var a in t.colors)if(t.colors.hasOwnProperty(a)){e=t.colors[a];break}return e},R=function(){var e=i.style.landColor;return e||(e="lightgray"),e},z=function(e,t){var a=this,l={};e.forEach(function(e){var t=e[i.mapLocation],a=bluewave.chart.utils.parseFloat(e[i.mapValue]);isNaN(a)||(l[t]=a)});var o=7,n=Y(Object.values(l),7),s=chroma.scale(t),r=s.colors(n.length-1).reverse();this.getColor=function(e,t){var l=a.getValue(e);return isNaN(l)?t:H(l,r,n)},this.getValue=function(e){return l[e]}},G=javaxt.dhtml.utils.merge,I=javaxt.dhtml.utils.isArray,W=javaxt.dhtml.utils.addShowHide,_=javaxt.dhtml.utils.createElement,U=bluewave.utils.createEditor,q=bluewave.utils.createSlider,j=bluewave.chart.utils.getType,X=bluewave.utils.parseData,Y=bluewave.chart.utils.getNaturalBreaks;r()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.SankeyEditor=function(e,t){var a=Math.ceil,l=Math.abs,o=this,s={margin:{top:10,right:10,bottom:10,left:10},nodes:[{icon:"fas fa-sign-out-alt",label:"Input"},{icon:"fas fa-random",label:"Distributor"},{icon:"fas fa-sign-in-alt",label:"Output"}],sankey:{style:{links:{color:"#ccc",opacity:.3}}},hidePreview:!1,renderers:{drawflowNodes:void 0}},r={},d={},u={},c={},r={},y=0,m=function(){var a={};me(a,t),me(a,s),t=a,t.style||(t.style=javaxt.dhtml.style.default),f=t.waitmask,f||(f={show:function(){},hide:function(){}});var l=document.createElement("div");l.style.height="100%",l.style.position="relative",l.style.overflow="hidden",pe(l);var i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="absolute",l.appendChild(i),b=document.createElement("div"),b.style.height="100%",b.style.textAlign="center",i.appendChild(b),ge(b),re(b),b.hide(),g=document.createElement("div"),g.className="drawflow",g.ondrop=J,g.ondragover=function(t){t.preventDefault()},g.onwheel=function(t){t.preventDefault(),V&&(0<t.deltaY?Q():K())},i.appendChild(g),z(g),X(g),G(g),ge(g),e.appendChild(l),o.el=l,ge(o)},g,b,f,C,w,v,k,T,L,V,E,N,D,O,F,S,A,B;this.onChange=function(){},this.onContextMenu=function(e){},this.onNodeImport=function(e){},this.clear=function(){V.clear(),V.removeModule(E),E=null,P("Untitled",!0),O.clear(),d={},c={},y=0},this.update=function(e){o.clear();var a=null,l=!1;if(e.inputs)for(var r in e.inputs)if(e.inputs.hasOwnProperty(r)){var u=e.inputs[r];if(u.config.nodes||u.config.links){a=u.config,l=!0;break}}if(a||(a={}),me(a,e.config),a=JSON.parse(JSON.stringify(a)),P(a.chartTitle,!0),a.style||(a.style={}),t.sankey.style=me(a.style,s.sankey.style),F.setValue("Edit"),!0===t.hidePreview?F.hide():F.show(),E="sankey_"+new Date().getTime(),V.addModule(E),V.changeModule(E),a.layout){var p={drawflow:{}};p.drawflow[E]={data:a.layout},V.import(p)}for(var r in a.nodes)if(a.nodes.hasOwnProperty(r)){var h=V.getNodeFromId(r),y=document.createElement("div");y.innerHTML=h.html;var e=document.getElementById(y.childNodes[0].id),m=a.nodes[r];for(var b in m)if(m.hasOwnProperty(b)){var f=m[b];e[b]=f}for(var b in ee(e),e.inputs={},h.inputs)if(h.inputs.hasOwnProperty(b)){var C=h.inputs[b].connections;for(var w in C){var x=C[w],v=x.node,k=d[v];e.inputs[v]=k}}d[r]=e,o.onNodeImport(e,m)}for(var r in d){var e=d[r];for(var v in e.inputs){var k=e.inputs[v];k||(e.inputs[v]=d[v])}}for(var C=g.getElementsByTagName("svg"),w=0;w<C.length;w++){var x=C[w],T=H(x),v=T[0],L=T[1],b=v+"->"+L,N=a.links[b];c[b]=N.quantity;var D=x.getElementsByTagName("path")[0];D.setAttribute("d",N.path),ye(D,function(){M(this)}),q()}Y(a.zoom),l&&(F.hide(),F.setValue("Preview"))};var M=function(e){var t=e.parentNode,i=H(t),n=i[0]+"->"+i[1],s=c[n],r=e.getTotalLength(),l=e.getPointAtLength(r/2),d=d3.select(e.parentNode),p=d.append("g").attr("transform","translate(-9999,-9999)").on("click",function(){var e=he();e.label=d3.select(this),o.showMenu(e,this)}),m=d.append("text").attr("text-anchor","start").text(s),g=m.node().getBBox();m.remove();var b=Math.max(g.width+8,60),f=g.height,h=f/2,C=l.x+h,w=l.y-h,y=[[C,w],[C+b,w],[C+b,w+f],[C,w+f],[C-h,w+h]];p.append("polygon").attr("points",y.join(" ")).style("fill","#459db7");var h=f/3;p.append("text").attr("x",C+h).attr("y",l.y+h).attr("text-anchor","start").style("fill","#fff").text(s),u[n]=p};this.getNodes=function(){return d},this.getConfig=function(){var e={layout:E?V.export().drawflow[E].data:{},nodes:{},links:{},chartTitle:R(),style:t.sankey.style,zoom:y};for(var a in e.layout)if(e.layout.hasOwnProperty(a)){var l=e.layout[a];l.html=d[a].parentNode.innerHTML}for(var a in d)if(d.hasOwnProperty(a)){var l=d[a];for(var o in e.nodes[a]={name:l.name,type:l.type,notes:l.notes},l)if(l.hasOwnProperty(o)){var n=l[o],s=!1;"string"==typeof n?s=!0:isNaN(n)?(!0===n||!1===n)&&(s=!0):s=!0,s&&(e.nodes[a][o]=n)}}for(var r=g.getElementsByTagName("svg"),u=0;u<r.length;u++){var p=r[u],h=H(p),m=p.getElementsByTagName("path")[0];m&&(m=m.getAttribute("d"));var a=h[0]+"->"+h[1];e.links[a]={path:m,quantity:c[a]}}return e};var H=function(e){var t=e.className;t.baseVal&&(t=t.baseVal);for(var a=t.split(" "),l=0,i,o;l<a.length;l++){var n=a[l].trim(),s=n.indexOf("node_in_node");0===s&&(o=n.substring(12+1));var s=n.indexOf("node_out_node");0===s&&(i=n.substring(13+1))}return[i,o]};this.getChart=function(){return b.isVisible()||F.setValue("Preview"),b},this.renderChart=function(e){var a=new bluewave.charts.SankeyChart(e,t.sankey),l=o.getSankeyData();return a.update(t.sankey.style,l),a},this.getEditor=function(){return b.isVisible()&&F.setValue("Edit"),g};var P=function(e,t){e||(e="Untitled"),C.title.innerHTML=e,L.innerHTML=e;!0===t||o.onChange()},R=function(){var e=C.title.innerHTML;return e?e:null},z=function(e){var t=document.createElement("div");t.style.position="absolute",t.style.width="100%",t.style.textAlign="center",t.style.zIndex=2,e.appendChild(t),L=document.createElement("div"),L.className="chart-title noselect",L.style.display="inline-block",L.style.backgroundColor="rgba(255,255,255,0.7)",L.style.padding="5px 10px",t.appendChild(L),fe(L,function(e){P(e)})},G=function(e){w=document.createElement("div"),w.className="drawflow-toolbar",e.appendChild(w),v=new javaxt.dhtml.Callout(document.body,{style:{panel:"tooltip-panel",arrow:"tooltip-arrow"}});var a=v.hide;v.hide=function(){k&&clearTimeout(k),a()};for(var l=0,o;l<t.nodes.length;l++)o=t.nodes[l],se(o.icon,o.label)},I=function(e){var t=d[e],a=t.inputs,l=0;for(var i in a)if(a.hasOwnProperty(i)){var o=c[i+"->"+e];l+=o}return 0==l&&(l=1),l},W=function(){for(var e in d){var t=d[e],a=t.inputs,l=_(e),o=0,s=0;for(var r in a)if(a.hasOwnProperty(r)){var u=d[r],p=c[r+"->"+e];o+=p}for(var h=0;h<l.length;h++){var r=l[h],u=d[r],p=c[e+"->"+r];s+=p}var y=V.drawflow.drawflow[E].data,m=y[e];t.style.color=U(m)&&o!=s?"red":"black"}q()},_=function(e){var t=[];for(var a in d){var l=d[a],i=l.inputs;for(var o in i)e===o&&t.push(a)}return t},U=function(e){return 0!==Object.keys(e.inputs).length&&0!==Object.keys(e.outputs).length},q=function(){var e=g.getElementsByClassName("connection");for(var t of e){var a=t.classList,l=[];for(var i of a)i.includes("node")&&l.push(i);var o=t.children[0];j(l,o)}},j=function(e,t){var a=e[0].substring(12+1),l=e[1].substring(13+1),i=d[a],o=d[l];("undefined"!=typeof i||"undefined"!=typeof o)&&("red"==i.style.color||"red"==o.style.color?t.style.stroke="red":t.style.stroke="")},X=function(e){V=new Drawflow(e),V.reroute=!0,V.start();var t,a;V.on("click",function(l){t=l.clientX,a=l.clientY}),V.on("connectionCreated",function(e){var t=e.output_id+"",a=e.input_id+"",l=t+"->"+a,n=d[a];n.inputs[t]=d[t];var s=I(t);c[l]=s;for(var r=g.getElementsByTagName("svg"),u=0;u<r.length;u++){var p=r[u],h=H(p);if(h[1]===a&&h[0]===t){var y=p.getElementsByTagName("path")[0];M(y);break}}W(),o.onChange()}),V.on("connectionRemoved",function(e){var t=e.output_id+"",a=e.input_id+"",l=t+"->"+a,i=u[l];i&&i.remove(),delete u[l],delete c[l],W(),o.onChange()}),V.on("nodeRemoved",function(e){delete d[e+""],W(),o.onChange()}),V.on("nodeMoved",function(e){for(var t in u)if(u.hasOwnProperty(t)){var a=t.split("->");if(a[0]===e||a[1]===e){var l=u[t],i=l.node().previousSibling;l&&l.remove(),delete u[t],M(i)}}}),V.on("contextmenu",function(t){setTimeout(function(){for(var e in d)if(d.hasOwnProperty(e)){var t=d[e],a=t.parentNode.parentNode,l=a.getElementsByClassName("drawflow-delete")[0];l&&(o.onContextMenu(t),a.removeChild(l),l=document.createElement("div"),l.className="drawflow-delete2",a.appendChild(l),l.innerHTML="&#x2715",l.onclick=function(){var e=this;confirm("Are you sure you want to delete this node?",{leftButton:{label:"Yes",value:!0},rightButton:{label:"No",value:!1},callback:function(t){t?V.removeNodeId(e.parentNode.id):e.parentNode.removeChild(e)}})})}},200)})},Y=function(e){if(e=parseInt(e),!(isNaN(e)||e===y))for(var t=l(e,y),a=0;a<t;a++)e<y?Q():K()},K=function(){V.zoom_in(),y++},Q=function(){V.zoom_out(),y--},$=function(e){"touchstart"===e.type||e.dataTransfer.setData("node",e.target.getAttribute("data-node"))},J=function(e){if("touchend"===e.type);else{e.preventDefault();let t=e.dataTransfer.getData("node");Z(t,e.clientX,e.clientY)}},Z=function(e,a,l){if("fixed"===V.editor_mode)return!1;a=a*(V.precanvas.clientWidth/(V.precanvas.clientWidth*V.zoom))-V.precanvas.getBoundingClientRect().x*(V.precanvas.clientWidth/(V.precanvas.clientWidth*V.zoom)),l=l*(V.precanvas.clientHeight/(V.precanvas.clientHeight*V.zoom))-V.precanvas.getBoundingClientRect().y*(V.precanvas.clientHeight/(V.precanvas.clientHeight*V.zoom));var s=r[e];if(!s)return void console.log("Unsupported Node Type: "+e);var u=s.el.dataset.title,p=0;for(var h in d)if(d.hasOwnProperty(h)){var c=d[h],y=c.type;y===e&&p++}0<p&&(u+=" "+(p+1));var m=s.el.dataset.icon,g=document.createElement("i");g.className=m;for(var i=0,b=0,f=0,C;f<t.nodes.length;f++)if(C=t.nodes[f],C.label===e){0==f?b=1:f==t.nodes.length-1?i=1:(i=1,b=1);break}var c=ae({name:u,type:e,icon:m,content:g,position:[a,l],inputs:i,outputs:b});ee(c),o.onChange()},ee=function(e){e.ondblclick=function(){le(this)}},te=function(e){var t=document.createElement("div"),a=document.createElement("div");a.className="drawflow-node-title",a.innerHTML="<i class=\""+e.icon+"\"></i><span>"+e.name+"</span>",t.appendChild(a);var l=document.createElement("div");l.className="drawflow-node-body";var i=e.content;return i&&("string"==typeof i?l.innerHTML=i:l.appendChild(i)),t.appendChild(l),t},ae=function(e){var a;a=t.renderers.drawflowNodes?t.renderers.drawflowNodes(e):te(e);var l=new Date().getTime();a.id="drawflow_node_"+l;var i=V.addNode(e.type,e.inputs,e.outputs,e.position[0],e.position[1],"",{},a.outerHTML);a=document.getElementById(a.id),a.name=e.name,a.type=e.type,a.inputs={},a.outputs={},d[l+""]=a;var o=V.drawflow.drawflow[E].data,n=o[i];n.id=l,o[l+""]=n,delete o[i];var s=a.parentNode,r=s.parentNode;return r.id="node_"+l,a};this.getNodeEditor=function(){if(!N){N=new javaxt.dhtml.Window(document.body,{title:"Edit Node",width:400,valign:"top",modal:!0,resizable:!1,style:t.style.window});var e=new javaxt.dhtml.Form(N.getBody(),{style:t.style.form,items:[{name:"name",label:"Name",type:"text"},{name:"notes",label:"Notes",type:"textarea"}],buttons:[{name:"Cancel",onclick:function(){i(),N.close()}},{name:"Submit",onclick:function(){var t=e.getData(),i=t.name;return i&&(i=i.trim()),null==i||""===i?void we("Name is required",a):void(f.show(),ie(i,N.node,function(e){f.hide(),e?l():we("Name is not unique",a)}))}}]}),a=e.findField("name"),l=function(){N.close();var t=N.node;if(t){var a=e.getData();t.name=a.name,t.notes=a.notes,t.name&&(t.name=t.name.trim(),0<t.name.length&&(t.childNodes[0].getElementsByTagName("span")[0].innerHTML=t.name))}},i=function(){var t=N.node;t&&(t.name&&e.setValue("name",t.name),t.notes&&e.setValue("notes",t.notes))};N.update=function(t){e.clear(),a.resetColor&&a.resetColor(),N.node=t,t&&(t.name&&e.setValue("name",t.name),t.notes&&e.setValue("notes",t.notes))}}return N};var le=function(e){var t=o.getNodeEditor();t.update(e),t.show()},ie=function(e,t,a){var l=!0;for(var i in d)if(d.hasOwnProperty(i)){var n=d[i],s=n.name;if(n!==t&&e.toLowerCase()===s.toLowerCase()){l=!1;break}}a.apply(o,[l])};this.getLinkEditor=function(){if(!D){var e={};D=new javaxt.dhtml.Window(document.body,{title:"Edit Link",width:400,valign:"top",modal:!0,resizable:!1,style:t.style.window});var a=new javaxt.dhtml.Form(D.getBody(),{style:t.style.form,items:[{name:"quantity",label:"Quantity",type:"text"}],buttons:[{name:"Cancel",onclick:function(){D.close()}},{name:"Submit",onclick:function(){var t=a.getData(),i=t.quantity;return i&&(i=parseFloat(i.trim())),isNaN(i)?void we("Quantity is required",l):void(c[e.from+"->"+e.to]=i,e.label.select("text").text(i),D.close(),o.onChange())}}]}),l=a.findField("quantity");D.update=function(t){a.clear(),l.resetColor&&l.resetColor();var i=t.node().parentNode,o=H(i);e.from=o[0],e.to=o[1],e.label=t;var n=c[e.from+"->"+e.to];l.setValue(n)}}return D};var oe=function(e){var t=o.getLinkEditor();t.update(e),t.show()},ne=function(e){var t=e.node().parentNode,a=H(t);V.removeSingleConnection(a[0],a[1],"output_1","input_1")},se=function(e,t){var l=new javaxt.dhtml.Button(w,{display:"table",disabled:!1,style:{button:"drawflow-toolbar-button",select:"drawflow-toolbar-button-selected",hover:"drawflow-toolbar-button-hover",label:"drawflow-toolbar-button-label",icon:"drawflow-toolbar-button-icon "+e}});return l.el.dataset.node=t,l.el.dataset.icon=e,l.el.dataset.title=t,l.el.draggable=!0,l.el.ondragstart=function(t){return!l.isDisabled()&&void $(t)},l.el.onmouseover=function(t){var e=this;if(k&&clearTimeout(k),l.isEnabled()){var i=function(){var t=e.dataset.node,l=e.dataset.title,i="Add "+(null==l?t:l);v.getInnerDiv().innerHTML=i;var o=javaxt.dhtml.utils.getRect(e),n=javaxt.dhtml.utils.getRect(e.parentNode),s=n.x+n.width+3,r=o.y+a(o.height/2);v.showAt(s,r,"right","center"),T=new Date().getTime()},o=!1;T&&3e3>new Date().getTime()-T&&(o=!1),o?k=setTimeout(i,1e3):i()}},l.el.onmouseleave=function(){v.hide()},l.el.onmousedown=function(){v.hide()},r[t]=l,l},re=function(e){C=be(e,{width:"1000px",height:"644px",title:"Untitled",settings:!0});var a=C.el;a.className="dashboard-item",a.style.float="none",fe(C.title,function(e){P(e)}),C.settings.onclick=function(){ue()},O=new bluewave.charts.SankeyChart(C.innerDiv,t.sankey)},de=function(){var e=o.getSankeyData();O.update(t.sankey.style,e)};this.getSankeyData=function(){var e={nodes:[],links:[]};for(var t in d)if(d.hasOwnProperty(t)){var a=d[t],l=a.name;e.nodes.push({name:l,group:a.type});var i=a.inputs;for(var o in i)if(i.hasOwnProperty(o)){var s=d[o],r=c[o+"->"+t];e.links.push({source:s.name,target:l,value:r})}}return e};var ue=function(){if(!S){var e=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}),a=new javaxt.dhtml.ComboBox(document.createElement("div"),{style:t.style.combobox});a.add("Solid color","#ccc"),a.add("Source color","source");var l=new javaxt.dhtml.Form(e.getBody(),{style:t.style.form,items:[{group:"Links",items:[{name:"linkColor",label:"Color",type:a},{name:"linkOpacity",label:"Opacity",type:"text"}]}]});Ce("linkOpacity",l,"%"),S=l,S.show=function(){e.show(),l.resize()}}var i=t.sankey.style;S.onChange=function(){},S.findField("linkColor").setValue(i.links.color),S.findField("linkOpacity").setValue(100*i.links.opacity),S.onChange=function(){var e=S.getData();i.links.color=e.linkColor,i.links.opacity=e.linkOpacity/100,de()},S.show()},pe=function(e){var t=document.createElement("div");t.style.position="absolute",t.style.top="20px",t.style.right="20px",t.style.zIndex=2,e.appendChild(t);var a=["Edit","Preview"];F=bluewave.utils.createToggleButton(t,{options:a,defaultValue:a[0],onChange:function(e){"Edit"===e?(b.hide(),g.show()):(g.hide(),b.show(),de())}}),ge(F)};this.showMenu=function(e,t){for(var a=0,l=0,n;l<e.childNodes.length;l++)n=e.childNodes[l],n.isVisible()&&a++;if(0!==a){for(var s=o.getCallout(),r=s.getInnerDiv();r.firstChild;)r.removeChild(r.lastChild);r.appendChild(e);var d=javaxt.dhtml.utils.getRect(t),u=d.x+d.width/2,p=d.y+d.height+3;s.showAt(u,p,"below","right")}};var he=function(){if(!B){var e=document.createElement("div");e.className="app-menu",e.appendChild(ce("Edit Quantity","edit",function(){oe(B.label)})),e.appendChild(ce("Delete Link","times",function(){ne(B.label)})),B=e}return B},ce=function(e,t,a){var l=document.createElement("div");return l.className="app-menu-item noselect",l.innerHTML=t&&0<t.length?"<i class=\"fas fa-"+t+"\"></i>"+e:e,l.label=e,l.onclick=function(){A.hide(),a.apply(this,[e])},ge(l),l};this.getCallout=function(){if(A){var e=A.el.parentNode;e||(A.el.innerHTML="",A=null)}return A||(A=new javaxt.dhtml.Callout(document.body,{style:t.style.callout})),A};var ye=function(e,t){var a=e.getBBox(),l=a.width;if(0===l||isNaN(l)){var i=function(){var a=e.getBBox(),l=a.width;0===l||isNaN(l)?o=setTimeout(i,100):(clearTimeout(o),t&&t.apply(e,[a]))},o;o=setTimeout(i,100)}else t&&t.apply(e,[a])},me=javaxt.dhtml.utils.merge,ge=javaxt.dhtml.utils.addShowHide,be=bluewave.utils.createDashboardItem,fe=bluewave.utils.addTextEditor,Ce=bluewave.utils.createSlider,we=bluewave.utils.warn;m()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.PieEditor=function(e,t){var a=Math.round,l=this,i={panel:{},colors:bluewave.utils.getColorGradients(),chart:{pieCutout:.65,piePadding:0,pieSort:"value",pieSortDir:"descending",maximumSlices:0,labelOffset:120,showOther:!0,showTooltip:!0}},o=[],n={},s={},r=function(){t||(t={}),t=m(t,i),s=t.chart,d=b(e,{onSettings:function(){s&&y()},onResize:function(){c()},onTitleChange:function(e){s.chartTitle=e}}),l.el=d.el},d,u;this.update=function(e){l.clear();var a={};for(var i in m(a,e.config),m(a,t.chart),s=a,e.inputs)if(e.inputs.hasOwnProperty(i)){var n=e.inputs[i],r=w(n.data,n.config);if(0<r.length)o.push(r);else{var u=n.config;u&&o.push(u)}}var r=o[0],h=[];if(r.hasOwnProperty("links")){r=Object.values(r.links);var y=[];for(var e in o[0].nodes){var g=o[0].nodes[e].type,b=o[0].nodes[e].name,f={};f.id=e,f.type=g,f.name=b,y.push(f)}for(var C in o[0].links){var x="",v="",k="",T=o[0].links[C].quantity;for(var L of y)C.startsWith(L.id)&&(x=L.type),C.endsWith(L.id)&&(v=L.type,k=L.name);var V=x+" to "+k,E={};E.key=V,E.value=T,E.sendType=x,E.receiveType=v;var N=h.findIndex(e=>e.key===V);-1===N?h.push(E):h[N].value+=T}r=h.slice(),r=r.filter(e=>e.key.includes(s.pieKey)),r="Inbound"===s.pieDirection?r.filter(e=>e.receiveType.endsWith(s.pieKey)):r.filter(e=>e.sendType.startsWith(s.pieKey));let t=[];r.forEach(function(e,a){let l={};e.key.includes(s.pieKey)&&(l[s.pieKey]=e.key,l[s.pieValue]=e.value),t.push(l)}),o=[t]}s.chartTitle&&d.setTitle(s.chartTitle),p(d.getLeftPanel()),c()},this.clear=function(){o=[],s={},d.clear()},this.getConfig=function(){return s},this.getChart=function(){return d.getChartArea()},this.renderChart=function(e){var t=new bluewave.charts.PieChart(e,{});return c(t),t};var p=function(e){var t=o[0],a=t.hasOwnProperty("links"),l;if(a){t=Object.values(t.links);var i=[];for(var r in t.nodes){var d=t.nodes[r].type;-1===i.indexOf(d)&&i.push(d)}l=i}else l=Object.keys(t[0]);var u=[];l.forEach(e=>{var a=[];t.forEach(t=>{var l=t[e];a.push(l)});var l=C(a);("number"==l||"currency"==l)&&u.push(e)});var p=g(e);p.style.height="",a?(h(p,"pieKey","Group By","key"),h(p,"pieDirection","Direction","direction"),l.forEach(e=>{n.key.add(e,e)}),s.pieValue="quantity",n.direction.add("Inbound"),n.direction.add("Outbound"),n.direction.setValue(s.pieDirection,!0)):(h(p,"pieKey","Key","key"),l.forEach(e=>{n.key.add(e,e)}),h(p,"pieValue","Value","value"),u.forEach(e=>{n.value.add(e,e)}),h(p,"pieSort","Sort By","sort"),n.sort.add(""),n.sort.add("Key"),n.sort.add("Value"),h(p,"pieSortDir","Sort Direction","sortDir")),n.key.setValue(s.pieKey,!0),"object"==typeof n.value&&n.value.setValue(s.pieValue,!0)},h=function(e,a,l,i){var o;o=e.addRow().addColumn(),o.innerHTML=l+":",o=e.addRow().addColumn(),n[i]=new javaxt.dhtml.ComboBox(o,{style:t.style.combobox,readOnly:!0}),n[i].clear(),n[i].onChange=function(e,l){if(!("pieSort"===a)){s[a]=l;var i=n.key.getValue(),o=n.value.getValue();if(i&&o&&(i=(i+"").trim(),o=(o+"").trim(),0<i.length&&0<o.length)){var r=t.chart.pieSort;r&&n.sort.setValue(r,!0);var d=t.chart.pieSortDir;d&&n.sortDir.setValue(d,!0),c()}}else if(0<l.length){s[a]=l;var u=n.sortDir.getValue();u||(u="Ascending"),n.sortDir.clear(),n.sortDir.add("Ascending"),n.sortDir.add("Descending"),n.sortDir.setValue(u)}else delete s[a],n.sortDir.clear(),c()}},c=function(e){if(e)e.clear();else{var t=d.getChartArea();t.innerHTML="",e=new bluewave.charts.PieChart(t,{})}e.update(s,o)},y=function(){u||(u=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=u.getBody();e.innerHTML="";var l=bluewave.utils.createColorField({colors:t.colors,style:t.style}),i=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"color",label:"Color",type:l},{name:"cutout",label:"Cutout",type:"text"}]},{group:"Slices",items:[{name:"padding",label:"Padding",type:"text"},{name:"maximumSlices",label:"Max Slices",type:"text"},{name:"showOther",label:"Show Other",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Labels",items:[{name:"labels",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"extendLines",label:"Extend Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"labelOffset",label:"Label Offset",type:"text"}]}]});l.setValue(JSON.stringify(s.colors)),f("cutout",i,"%");var n=a(100*s.pieCutout);i.findField("cutout").setValue(n);var r=i.findField("labels"),d=s.showLabels;r.setValue(!(!0!==d));var p=i.findField("extendLines"),h=s.extendLines;p.setValue(!(!0!==h)),f("labelOffset",i,"%",0,120,1);var y=s.labelOffset;i.findField("labelOffset").setValue(y),f("padding",i,"%",0,100,1);var m=s.piePadding,g=5;m=a(100*(m/g)),i.findField("padding").setValue(m);var b=i.findField("showOther"),C=s.showOther;b.setValue(!(!0!==C));var w=o[0].length;f("maximumSlices",i,"",1,w,1);var x=parseInt(s.maximumSlices);(isNaN(x)||1>x||x>w)&&(x=w),i.findField("maximumSlices").setValue(x),i.onChange=function(){var e=i.getData();s.pieCutout=e.cutout/100,s.piePadding=e.padding*g/100;var t=parseInt(e.maximumSlices);(isNaN(t)||1>t||t>w)&&(t=w),s.maximumSlices=t,"true"===e.labels?(e.labels=!0,i.enableField("labelOffset"),i.enableField("extendLines")):"false"===e.labels&&(e.labels=!1,i.disableField("labelOffset"),i.disableField("extendLines")),s.showLabels=e.labels,s.extendLines="true"===e.extendLines,s.labelOffset=e.labelOffset,"true"===e.showOther?e.showOther=!0:"false"===e.showOther&&(e.showOther=!1),s.showOther=e.showOther,s.colors=JSON.parse(e.color),c()},u.showAt(108,57),i.resize()},m=javaxt.dhtml.utils.merge,g=javaxt.dhtml.utils.createTable,b=bluewave.utils.createEditor,f=bluewave.utils.createSlider,C=bluewave.chart.utils.getType,w=bluewave.utils.parseData;r()},!bluewave)var bluewave={};if(bluewave.editor||(bluewave.editor={}),bluewave.editor.ScatterEditor=function(e,t){var a=this,l={panel:{},chart:{pointColor:"#6699cc",pointRadius:7,pointOpacity:.8,showRegLine:!1,showTooltip:!0}},i=[],o={},s={},r=function(){t||(t={}),t=b(t,l),s=t.chart,d=x(e,{onSettings:function(){s&&m()},onResize:function(){y()},onTitleChange:function(e){s.chartTitle=e}}),a.el=d.el},d,u,p;this.update=function(e){a.clear();var l={};for(var o in b(l,e.config),b(l,t.chart),s=l,e.inputs)if(e.inputs.hasOwnProperty(o)){var n=e.inputs[o],r=T(n.data,n.config);0<r.length&&i.push(r)}s.chartTitle&&d.setTitle(s.chartTitle),h(d.getLeftPanel())},this.clear=function(){i=[],s={},d.clear(),p&&p.hide()},this.getConfig=function(){return s},this.getChart=function(){return d.getChartArea()},this.renderChart=function(e){var t=new bluewave.charts.ScatterChart(e,{});return y(t),t};var h=function(e){var t=C(e);t.style.height="",c(t,"xAxis","X-Axis",y),c(t,"yAxis","Y-Axis",y);var a=i[0];let l=Object.keys(a[0]);l.forEach(e=>{o.xAxis.add(e,e),o.yAxis.add(e,e)}),o.xAxis.setValue(s.xAxis,!1),o.yAxis.setValue(s.yAxis,!1)},c=function(e,a,l,i){var n;n=e.addRow().addColumn(),n.innerHTML=l+":",n=e.addRow().addColumn(),o[a]=new javaxt.dhtml.ComboBox(n,{style:t.style.combobox,readOnly:!0}),o[a].onChange=function(e,t){s[a]=t,i()}},y=function(e){if(e)e.clear();else{var t=d.getChartArea();t.innerHTML="",e=new bluewave.charts.ScatterChart(t,{})}e.update(s,i)},m=function(){u||(u=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:t.style.window}));var e=u.getBody();e.innerHTML="";var a=new javaxt.dhtml.ComboBox(w("div"),{style:t.style.combobox,readOnly:!1}),o=[];i.forEach(function(e,t){var a=0<t?t+1:"";let l=`xAxis${a}`;var i=s[l];i&&e.forEach(e=>{o.push(e[i])})});var n=k(o);if("number"==n||"currency"==n){var r=Number.MAX_VALUE,d=0;o.forEach(e=>{var t=bluewave.chart.utils.parseFloat(e);r=Math.min(t,r),d=Math.max(t,d)}),a.add("0",0),0!=r&&a.add(r+"",r),a.setValue(0)}var p=new javaxt.dhtml.Form(e,{style:t.style.form,items:[{group:"General",items:[{name:"pointLabels",label:"Display Point Labels",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Analysis",items:[{name:"showRegLine",label:"Enable Regression Line",type:"checkbox",options:[{label:"",value:!0}]}]},{group:"Points",items:[{name:"pointColor",label:"Color",type:new javaxt.dhtml.ComboBox(w("div"),{style:t.style.combobox})},{name:"pointOpacity",label:"Point Opacity",type:"text"},{name:"pointRadius",label:"Radius",type:"text"}]},{group:"X-Axis",items:[{name:"xLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"xGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]},{name:"xMin",label:"Min Value",type:a}]},{group:"Y-Axis",items:[{name:"yLabel",label:"Show Labels",type:"checkbox",options:[{label:"",value:!0}]},{name:"yGrid",label:"Show Grid Lines",type:"checkbox",options:[{label:"",value:!0}]}]}]}),h=p.findField("xGrid"),c=s.xGrid;h.setValue(!(!0!==c));var m=p.findField("yGrid"),b=s.yGrid;m.setValue(!(!0!==b));var C=p.findField("xLabel"),x=s.xLabel;C.setValue(!!x);var T=p.findField("yLabel"),L=s.yLabel;T.setValue(!!L);var V=p.findField("pointLabels"),E=s.showPointLabels;V.setValue(!(!0!==E)),g("pointColor",p),p.findField("pointColor").setValue(s.pointColor),v("pointRadius",p,"px",0,20,1);var N=parseInt(s.pointRadius);(isNaN(N)||1>N)&&(N=l.chart.pointRadius),p.findField("pointRadius").setValue(N),v("pointOpacity",p,"%");var D=parseFloat(s.pointOpacity);(isNaN(D)||0>D||100<D)&&(D=l.chart.pointOpacity),p.findField("pointOpacity").setValue(f(100*D,0)),p.onChange=function(){var e=p.getData();s.pointColor=e.pointColor,s.pointOpacity=e.pointOpacity/100,s.pointRadius=e.pointRadius,e.xGrid=!("true"!==e.xGrid),e.yGrid=!("true"!==e.yGrid),e.xLabel="true"===e.xLabel?s.xAxis:null,e.yLabel="true"===e.yLabel?s.yAxis:null,e.pointLabels=!("true"!==e.pointLabels),e.showRegLine=!("true"!==e.showRegLine),s.xGrid=e.xGrid,s.yGrid=e.yGrid,s.xLabel=e.xLabel,s.yLabel=e.yLabel,s.pointLabels=e.pointLabels,s.showRegLine=e.showRegLine;var t=bluewave.chart.utils.parseFloat(a.getText());isNaN(t)||(s.xMin=t),y()},u.showAt(108,57),p.resize()},g=function(e,a){bluewave.utils.createColorOptions(e,a,function(e){p||(p=bluewave.utils.createColorPickerCallout(t));var a=javaxt.dhtml.utils.getRect(e.row),l=a.x+a.width+15,i=a.y+a.height/2;p.showAt(l,i,"right","middle"),p.setColor(e.getValue()),p.onChange=function(t){e.setValue(t)}})},b=javaxt.dhtml.utils.merge,f=javaxt.dhtml.utils.round,C=javaxt.dhtml.utils.createTable,w=javaxt.dhtml.utils.createElement,x=bluewave.utils.createEditor,v=bluewave.utils.createSlider,k=bluewave.chart.utils.getType,T=bluewave.utils.parseData;r()},!bluewave)var bluewave={};if(bluewave.Explorer=function(parent,config){var _Mathceil2=Math.ceil,_Mathabs2=Math.abs;this.className="bluewave.Explorer";var me=this,defaultConfig={nodes:[{title:"Pie Chart",type:"pieChart",icon:"fas fa-chart-pie",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.PieEditor},inputNodes:["datafile","filter","sankeyChart"]},{title:"Bar Chart",type:"barChart",icon:"fas fa-chart-bar",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.BarEditor},inputNodes:["datafile","filter"]},{title:"Line Chart",type:"lineChart",icon:"fas fa-chart-line",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.LineEditor},inputNodes:["datafile","filter"]},{title:"Histogram Chart",type:"histogramChart",icon:"fas fa-chart-area",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.HistogramEditor},inputNodes:["datafile","filter"]},{title:"Scatter Chart",type:"scatterChart",icon:"fas fa-braille",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.ScatterEditor},inputNodes:["datafile","filter"]},{title:"Map",type:"mapChart",icon:"fas fa-globe-americas",editor:{width:1180,height:700,resizable:!0,class:bluewave.editor.MapEditor},inputNodes:["datafile","filter"]},{title:"Treemap Chart",type:"treeMapChart",icon:"fas fa-basketball-ball",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.TreeMapEditor},inputNodes:["datafile","filter"]},{title:"Calendar Chart",type:"calendarChart",icon:"fas fa-th",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.CalendarEditor},inputNodes:["datafile","filter"]},{title:"Sankey Chart",type:"sankeyChart",icon:"fas fa-random",editor:{width:1680,height:920,resizable:!0,class:bluewave.editor.SankeyEditor}},{title:"Filter",type:"filter",icon:"fas fa-filter",editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.FilterEditor},inputNodes:["datafile"]}],toolbar:{nodes:["sankeyChart","pieChart","barChart","lineChart","histogramChart","scatterChart","mapChart","treeMapChart","calendarChart","filter"]},supportedFileTypes:["csv","tab","tsv","xls","xlsx","pdf"]},button={},nodes={},windows=[],zoom=0,init=function(){if(me.setConfig(config),!!parent){config.fx||(config.fx=new javaxt.dhtml.Effects),config.style||(config.style=javaxt.dhtml.style.default),waitmask=config.waitmask,waitmask||(waitmask={show:function(){},hide:function(){}});var e=createElement("div",parent,{height:"100%",position:"relative"});e.setAttribute("desc",me.className),e.onwheel=function(t){t.preventDefault(),drawflow&&(0<t.deltaY?zoomOut():zoomIn())},e.tabIndex=-1,createDrawFlow(e),tooltip=new javaxt.dhtml.Callout(document.body,{style:{panel:"tooltip-panel",arrow:"tooltip-arrow"}});var t=tooltip.hide;tooltip.hide=function(){tooltipTimer&&clearTimeout(tooltipTimer),t()},addShowHide(e),me.el=e,addShowHide(me)}},id,name,description,thumbnail,menubar,tooltip,tooltipTimer,lastToolTipEvent,drawflow,waitmask;this.onChange=function(e){},this.setConfig=function(e){config=e?merge(e,defaultConfig):defaultConfig},this.getConfig=function(){return config},this.addExtensions=function(e){e&&e.forEach(function(e){addExtension(e)})},this.setName=function(e){name=e},this.getName=function(){return name},this.setDescription=function(e){description=e},this.getDescription=function(){return description},this.setThumbnail=function(e){thumbnail=e},this.getThumbnail=function(){return thumbnail},this.setID=function(e){id=e},this.getID=function(){return id},this.getDashboard=function(){var e={id:id,name:name,description:description,className:me.className,thumbnail:thumbnail,info:{layout:drawflow.export().drawflow.Home.data,nodes:{},zoom:zoom}};for(var t in nodes)if(nodes.hasOwnProperty(t)){var a=nodes[t];e.info.nodes[t]={name:a.name,type:a.type,config:a.config,preview:a.preview},"datafile"===a.type&&a.data&&(e.info.nodes[t].data=a.data)}return e},this.getNodes=function(){return nodes},this.clear=function(){for(var e in id=name=description=thumbnail=null,nodes={},drawflow.clear(),button)button.hasOwnProperty(e)&&button[e].disable();for(var t in windows)windows[t].hide();zoom=0},this.update=function(e,t,a){if(e||(e={}),me.clear(),id=e.id,name=e.name,description=e.description,!description&&e.info&&(description=e.info.description),thumbnail=e.thumbnail,drawflow.editor_mode=t?"view":"edit",updateButtons(),me.el.focus(),!e.info)return void(a&&a.apply(me,[]));drawflow.import({drawflow:{Home:{data:e.info.layout}}});var l=[],o=[];for(var n in e.info.nodes)if(e.info.nodes.hasOwnProperty(n)){var s=drawflow.getNodeFromId(n),r=createElement("div");r.innerHTML=s.html;var d=document.getElementById(r.childNodes[0].id),u=e.info.nodes[n];for(var p in u)if(u.hasOwnProperty(p)){var h=u[p];d[p]=h}for(var p in"map"===d.type&&(d.type="mapChart"),u.config.chartTitle&&updateTitle(d,u.config.chartTitle),u.preview&&l.push({node:d,thumbnail:u.preview}),addEventListeners(d),d.inputs={},s.inputs)if(s.inputs.hasOwnProperty(p)){var c=s.inputs[p].connections;for(var y in c){var m=c[y],g=m.node,b=nodes[g];d.inputs[g]=b,o.push(g)}}nodes[n]=d}for(var n in nodes){var d=nodes[n];for(var g in d.inputs){var b=d.inputs[g];b||(d.inputs[g]=nodes[g])}}var f=[];for(var n in nodes){var d=nodes[n];if("filter"===d.type){var C=getNodeEditor(d);C&&f.push(C)}}var w=function(){updateButtons(),setTimeout(function(){for(var t=0,n;t<o.length;t++)n=o[t],drawflow.updateConnectionNodes("node-"+n);for(var t=0;t<l.length;t++)(function(e){var t=e.node.childNodes[1];onRender(t,function(){createThumbnail(e.node,e.thumbnail)})})(l[t]);setZoom(e.info.zoom),me.el.focus(),a&&a.apply(me,[])},500)};if(0===f.length)w();else{waitmask.show();var x=function(){if(0===f.length)return waitmask.hide(),void w();var e=f.shift(),t=e.getNode();e.update(t,function(){e.getData&&e.getData(function(e){t.data=e?JSON.parse(JSON.stringify(e)):[]}),e.clear(),x()})};x()}};var updateButtons=function(){for(var e in button)button.hasOwnProperty(e)&&button[e].disable();if(!me.isReadOnly()){var a={};for(var e in nodes)if(nodes.hasOwnProperty(e)){var l=nodes[e];a[l.type]=!0}config.nodes.forEach(function(e){var l=button[e.type];if(l){var i=e.inputNodes;i||(i=[]),0<i.length?i.every(function(e){var t=!1,i=!0;return("string"==typeof e?t=a[e]:(t=a[e.inputNode],i=e.required),t)?(l.enable(),!1):(i||l.enable(),!0)}):l.enable()}})}};this.setReadOnly=function(e){if(!0===e){if(me.isReadOnly())return;drawflow.editor_mode="view"}else{if(!me.isReadOnly())return;drawflow.editor_mode="edit"}updateButtons()},this.isReadOnly=function(){return"view"===drawflow.editor_mode},this.getToolbar=function(){return menubar},this.getButtons=function(){return button};var getFileNodes=function(){var e=[];for(var t in nodes)if(nodes.hasOwnProperty(t)){var a=nodes[t];isValidFile(a.type)&&e.push(a)}return e},createDrawFlow=function(e){var t=createElement("div",e,"drawflow");t.addEventListener("dragover",onDragOver,!1),t.addEventListener("drop",onDrop,!1),drawflow=new Drawflow(t),drawflow.reroute=!0,drawflow.start(),drawflow.on("connectionCreated",function(e){var t=e.output_id+"",a=e.input_id+"",l=nodes[a],i=nodes[t],o=!1;config.nodes.every(function(e){if(e.type===l.type){var t=e.inputNodes;return t&&t.forEach(function(e){"string"==typeof e?i.type===e&&(o=!0):e.inputNode===i.type&&(o=!0)}),!1}return!0}),o?(l.inputs[t]=i,l.ondblclick()):drawflow.removeSingleConnection(e.output_id,e.input_id,e.output_class,e.input_class),me.onChange("connectionCreated")}),drawflow.on("nodeRemoved",function(e){removeInputs(nodes,e);var t=nodes[e+""];delete nodes[e+""],updateButtons(),me.onChange("nodeRemoved",t)}),drawflow.on("connectionRemoved",function(e){var t=e.output_id+"",a=e.input_id+"",l=nodes[a];delete l.inputs[t+""],me.onChange("connectionRemoved")}),drawflow.on("contextmenu",function(t){setTimeout(function(){for(var e in nodes)if(nodes.hasOwnProperty(e)){var t=nodes[e],a=t.parentNode.parentNode,l=a.getElementsByClassName("drawflow-delete")[0];l&&(a.removeChild(l),l=createElement("div",a,"drawflow-delete2"),l.innerHTML="&#x2715",l.nodeID=parseInt(e),l.onclick=function(){var e=this,t=e.nodeID;confirm("Are you sure you want to delete this node?",{leftButton:{label:"Yes",value:!0},rightButton:{label:"No",value:!1},callback:function(a){a?drawflow.removeNodeId("node-"+t):e.parentNode.removeChild(e)}})})}},200)}),drawflow.on("nodeMoved",function(e){me.onChange("nodeMoved",nodes[e+""])}),menubar=createElement("div",t,"drawflow-toolbar"),config.toolbar.nodes.forEach(e=>{"string"==typeof e?config.nodes.every(t=>{if(e===t.type){var a=createMenuButton(t.type,t.icon,t.title);return t.inputNodes?isArray(t.inputNodes)&&0===t.inputNodes.length&&a.enable():a.enable(),!1}return!0}):isArray(e)})},setZoom=function(e){if(e=parseInt(e),!(isNaN(e)||e===zoom)){for(var t=_Mathabs2(e,zoom),a=0;a<t;a++)e<zoom?zoomOut():zoomIn();me.onChange("zoomChange")}},zoomIn=function(){drawflow.zoom_in(),zoom++},zoomOut=function(){drawflow.zoom_out(),zoom--},drag=function(e){"touchstart"===e.type||e.dataTransfer.setData("node",e.target.getAttribute("data-node"))},onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},onDrop=function(t){if(t.stopPropagation(),t.preventDefault(),"touchend"===t.type);else{var e=t.clientX,a=t.clientY,l=t.dataTransfer.files;if(0<l.length){for(var o={},n=getFileNodes(),s=0;s<n.length;s++){var r=n[s],d=r.config.fileName;o[d.toLowerCase()]=r}for(var u=[],s=0,p;s<l.length;s++)if(p=l[s],isValidFile(p)){var d=p.name.toLowerCase();o[d]||u.push(p)}if(0===u.length)return;var h=0,c=[];waitmask.show();var m=function(){if(0===u.length)return waitmask.hide(),void(0<c.length&&alert("Failed to upload "+c));var t=u.shift(),l=getFileExtension(t);if(isValidFile(l)){var i=new FormData;i.append(t.name,t),0<h&&(e+=35,a+=85),h++,addNodeToDrawFlow(l,e,a,t),m()}};m(),0<h&&updateButtons()}else{let l=t.dataTransfer.getData("node");addNodeToDrawFlow(l,e,a)}}},addNodeToDrawFlow=function(e,t,a,l){if("fixed"===drawflow.editor_mode)return!1;t=t*(drawflow.precanvas.clientWidth/(drawflow.precanvas.clientWidth*drawflow.zoom))-drawflow.precanvas.getBoundingClientRect().x*(drawflow.precanvas.clientWidth/(drawflow.precanvas.clientWidth*drawflow.zoom)),a=a*(drawflow.precanvas.clientHeight/(drawflow.precanvas.clientHeight*drawflow.zoom))-drawflow.precanvas.getBoundingClientRect().y*(drawflow.precanvas.clientHeight/(drawflow.precanvas.clientHeight*drawflow.zoom));var i=getNodeConfig(e);if(!i)return void console.log("Unsupported Node Type: "+e);l&&(i.type="datafile",i.title=l.name),e=i.type;var o=i.icon,n=i.title,s=0,r=1;i.inputNodes&&isArray(i.inputNodes)&&0<i.inputNodes.length&&(s=1),!1===i.output&&(r=0);var d=createNode({name:n,type:e,icon:o,content:createElement("i",o),position:[t,a],inputs:s,outputs:r});addEventListeners(d),me.onChange("nodeCreated",d),l&&(d.file=l,d.config.fileName=l.name,d.ondblclick())},addEventListeners=function(e){e.ondblclick=function(){var t=getNodeEditor(e);if(t){t.clear(),t.show();var a=t.getData?300:50;setTimeout(()=>{t.update(e)},a)}}},createNode=function(e){var t=createElement("div");t.id="_"+new Date().getTime();var a=createElement("div",t,"drawflow-node-title");a.innerHTML="<i class=\""+e.icon+"\"></i><span>"+e.name+"</span>";var l=createElement("div",t,"drawflow-node-body"),i=e.content;i&&("string"==typeof i?l.innerHTML=i:l.appendChild(i));var o=drawflow.addNode(e.type,e.inputs,e.outputs,e.position[0],e.position[1],"",{},t.outerHTML);return t=document.getElementById(t.id),t.type=e.type,t.inputs={},t.config={},nodes[o+""]=t,t},getNodeConfig=function(e){var t;if(config.nodes.every(a=>a.type!==e||(t=a,!1)),!t&&("datafile"===e||isValidFile(e)))switch(e){case"csv":case"xls":case"xlsx":case"datafile":var a="fas fa-file-alt";"csv"===e&&(a="fas fa-file-csv"),("xls"===e||"xlsx"===e)&&(a="fas fa-file-excel"),t={title:e+" Data",icon:a,editor:{width:1060,height:600,resizable:!0,class:bluewave.editor.CsvEditor}};break;case"pdf":var a="fas fa-file-pdf"}return t};this.getNodeEditor=function(e){return getNodeEditor(e)};var getNodeEditor=function(e){var t=getNodeConfig(e.type);if(t){var a=t.editor;if(a.class&&("datafile"===e.type&&(a.title=e.config.fileName),a=createNodeEditor(a),t.editor=a,a.onSave||a.onChange)){var l=function(){if(!me.isReadOnly()){var e=a.getConfig(),t=a.getNode();t.config=JSON.parse(JSON.stringify(e)),me.onChange("nodeUpdated",t)}};a.onSave&&(a.onSave=function(){l()}),a.onChange&&(a.onChange=function(){l()})}if(a.getNode=function(){return e},a.getData){var i=a.update;a.update=function(e,t){i(e,t),a.getData(function(t){e.data=t?JSON.parse(JSON.stringify(t)):[]})}}return a}},createNodeEditor=function(editorConfig){merge(editorConfig,{title:"Edit Chart",width:1060,height:600,resizable:!1,beforeClose:null,style:config.style});var style=merge({body:{padding:"0px"},closeIcon:{content:"&#x2715;",lineHeight:"16px",textAlign:"center"}},config.style.window),win=createWindow({title:editorConfig.title,width:editorConfig.width,height:editorConfig.height,modal:!0,resizable:editorConfig.resizable,shrinkToFit:!0,style:style,renderers:{headerButtons:function(e){var t=createElement("div",e,style.button);createElement("div",t,style.closeIcon),t.onclick=function(){if(editorConfig.beforeClose)editorConfig.beforeClose.apply(me,[win]);else{var e=win.editor,t=e.getNode();e.getData&&e.getData(function(e){t.data=e?JSON.parse(JSON.stringify(e)):[]});var a=e.getConfig(),l=t.config;if(l||(l={}),!isDirty(a,l))updateTitle(t,t.config.chartTitle),win.close(),e.clear();else if(me.onChange("nodeUpdated",t),t.config=JSON.parse(JSON.stringify(a)),updateTitle(t,t.config.chartTitle),e.getChart){waitmask.show();var i=e.getChart();i.show&&i.show(),setTimeout(function(){createPreview(i,function(a){a&&a.toDataURL&&(t.preview=a.toDataURL("image/png"),me.onChange("nodeUpdated",t),createThumbnail(t,a)),win.close(),e.clear(),waitmask.hide()},this)},800)}else win.close(),e.clear();updateButtons()}}}}});if(editorConfig.class){"string"==typeof editorConfig.class&&(editorConfig.class=eval(editorConfig.class));var editor=new editorConfig.class(win.getBody(),editorConfig);return editor.show=function(){win.show()},editor.hide=function(){win.hide()},win.onResize=function(){editor.resize&&editor.resize()},win.editor=editor,editor}},updateTitle=function(e,t){t&&(e.childNodes[0].getElementsByTagName("span")[0].innerHTML=t)},removeInputs=function(e,t){for(var a in e)if(e.hasOwnProperty(a)){var l=e[a];for(var i in l.inputs)i===t&&delete l.inputs[t+""]}},createWindow=function(e){var t=new javaxt.dhtml.Window(document.body,e);return windows.push(t),t},createPreview=function(e,t,a){html2canvas(e).then(e=>{t&&t.apply(a,[e])}).catch(function(e){t&&t.apply(a,["Preview Failed: "+e])})},createThumbnail=function(e,t){var a=e.childNodes[1];a.innerHTML="";var l=javaxt.dhtml.utils.getRect(a),i=l.width,o=l.height,n=createElement("div",a,{width:"100%",height:"100%"}),l=javaxt.dhtml.utils.getRect(n);a.innerHTML="";var s=i-l.width,r=i-s,d=o-s,i=0,o=0,u=function(){var e=r/i;i*=e,o*=e},p=function(){var e=d/o;i*=e,o*=e},h=function(e){if(i=e.width,o=e.height,d<r?(p(),i>r&&u()):(u(),o>d&&p()),0!==i&&0!==o){resizeCanvas(e,i,o,!0);var t=e.toDataURL("image/png"),l=createElement("img","noselect");l.onload=function(){a.appendChild(this)},l.src=t,l.ondragstart=function(t){t.preventDefault()}}};if("string"==typeof t){var c=createElement("img");c.onload=function(){var e=this,t=createElement("canvas");t.width=e.width,t.height=e.height;var a=t.getContext("2d");a.drawImage(e,0,0),h(t)},c.src=t}else h(t)},createMenuButton=function(e,t,a){var l=new javaxt.dhtml.Button(menubar,{display:"table",disabled:!0,style:{button:"drawflow-toolbar-button",select:"drawflow-toolbar-button-selected",hover:"drawflow-toolbar-button-hover",label:"drawflow-toolbar-button-label",icon:"drawflow-toolbar-button-icon "+t}});return l.el.dataset.node=e,l.el.dataset.icon=t,l.el.dataset.title=a,l.el.draggable=!0,l.el.ondragstart=function(t){return!l.isDisabled()&&void drag(t)},l.el.onmouseover=function(t){var e=this;if(tooltipTimer&&clearTimeout(tooltipTimer),l.isEnabled()){var a=function(){var t=e.dataset.node,a=e.dataset.title,l="Add "+(null==a?t:a);tooltip.getInnerDiv().innerHTML=l;var i=javaxt.dhtml.utils.getRect(e),o=javaxt.dhtml.utils.getRect(e.parentNode),n=o.x+o.width+3,s=i.y+_Mathceil2(i.height/2);tooltip.showAt(n,s,"right","center"),lastToolTipEvent=new Date().getTime()},i=!1;lastToolTipEvent&&3e3>new Date().getTime()-lastToolTipEvent&&(i=!1),i?tooltipTimer=setTimeout(a,1e3):a()}},l.el.onmouseleave=function(){tooltip.hide()},l.el.onmousedown=function(){tooltip.hide()},button[e]=l,l},addExtension=function(e){"editor"===e.type&&e.node&&addEditor(e.node)},addEditor=function(e){var t=!1;if(config.nodes.forEach(function(a){a.type===e.type&&(t=!0)}),!t)if(e.editor.class)config.nodes.push(e);else return void console.log("Failed to load "+e.title);button[e.type]||createMenuButton(e.type,e.icon,e.title)},getFileExtension=function(e){var t=e.name.toLowerCase(),a=t.substring(t.lastIndexOf(".")+1);return a},isValidFile=function(e){var t;t="string"==typeof e?e:getFileExtension(e);for(var a=!1,l=0;l<config.supportedFileTypes.length;l++)if(config.supportedFileTypes[l]===t){a=!0;break}return a},merge=javaxt.dhtml.utils.merge,onRender=javaxt.dhtml.utils.onRender,isDirty=javaxt.dhtml.utils.isDirty,isArray=javaxt.dhtml.utils.isArray,addShowHide=javaxt.dhtml.utils.addShowHide,createElement=javaxt.dhtml.utils.createElement,resizeCanvas=bluewave.utils.resizeCanvas;init()},!bluewave)var bluewave={};bluewave.utils={get:function(e,t){var a=null;2<arguments.length&&(a=arguments[1],t=arguments[2]);var l=javaxt.dhtml.utils.get;l(e,{payload:a,success:function(e){var a=e.substring(0,1);if("{"==a||"["==a){var l=JSON.parse(e);if(l.cols&&l.rows){for(var o=l.rows,n={},s=0;s<l.cols.length;s++)n[l.cols[s]]=s;for(var s=0;s<o.length;s++){var r=o[s],d={};for(var u in n)n.hasOwnProperty(u)&&(d[u]=r[n[u]]);o[s]=d}l=o}e=l}t.success&&t.success.apply(this,[e])},failure:function(e){t.failure&&t.failure.apply(this,[e])}})},getData:function(e,t,a){bluewave.data||(bluewave.data={}),1<arguments.length&&"function"==typeof arguments[1]&&(a=arguments[1],t="data/");var l=t.lastIndexOf("/");l!==t.length-1&&(t+="/");var i=t+e,o=javaxt.dhtml.utils.get,n=function(e){a&&a.apply(this,[e])};o(i,{success:function(e){0==e.indexOf("{")||0==e.indexOf("[")?n(JSON.parse(e)):n(e)},failure:function(){var t=e.indexOf("?");if(-1<t&&(e=e.substring(0,t)),bluewave.data[e])n(bluewave.data[e]);else{var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",i+".js?_="+new Date().getTime()),a.onload=function(){n(bluewave.data[e])};var l=document.getElementsByTagName("head")[0];l.appendChild(a)}}})},getMapData:function(e,t){if(0!==arguments.length){"function"==typeof arguments[0]&&(t=arguments[0],e="data/");var a=bluewave.utils.getData;bluewave.data||(bluewave.data={}),bluewave.data.mapData||(bluewave.data.mapData={});var l=bluewave.data.mapData.counties,i=bluewave.data.mapData.countries;l?i?t.apply(this,[bluewave.data.mapData]):a("countries",e,function(e){i=topojson.feature(e,e.objects.countries),bluewave.data.mapData.countries=i,t.apply(this,[bluewave.data.mapData])}):a("counties",e,function(o){l=topojson.feature(o,o.objects.counties),bluewave.data.mapData.counties=l;var n=topojson.feature(o,o.objects.states);bluewave.data.mapData.states=n,i?t.apply(this,[bluewave.data.mapData]):a("countries",e,function(e){i=topojson.feature(e,e.objects.countries),bluewave.data.mapData.countries=i,t.apply(this,[bluewave.data.mapData])})})}},warn:function(e,t){var a=t.row,l;l=a?a.childNodes[2]:t.el.parentNode,null==l&&(l=t.el.parentNode);var i=javaxt.dhtml.utils.getRect,o=i(l),n=l.getElementsByTagName("input");if(0==n.length&&(n=l.getElementsByTagName("textarea")),0<n.length){n[0].blur();var s="form-input-error";n[0].className?-1==n[0].className.indexOf("form-input-error")&&(n[0].className+=" form-input-error"):n[0].className="form-input-error",o=i(n[0]),t.resetColor=function(){n[0].className&&(n[0].className=n[0].className.replace("form-input-error",""))}}var r=bluewave.utils.formError;r||(r=new javaxt.dhtml.Callout(document.body,{style:{panel:"error-callout-panel",arrow:"error-callout-arrow"}}),bluewave.utils.formError=r),r.getInnerDiv().innerHTML=e;var d=o.x+o.width/2,u=o.y;r.showAt(d,u,"above","center")},createButton:function(e,t){return t=JSON.parse(JSON.stringify(t)),t.icon&&(t.style.icon="toolbar-button-icon "+t.icon,delete t.icon),!0===t.menu&&(t.style.arrow="toolbar-button-menu-icon",t.style.menu="menu-panel",t.style.select="panel-toolbar-menubutton-selected"),new javaxt.dhtml.Button(e,t)},createSpacer:function(e){javaxt.dhtml.utils.createElement("div",e,"toolbar-spacer")},createToggleButton:function(e,t){var a=javaxt.dhtml.utils.createElement,l={style:{panel:"toggle-button-bar noselect",button:"toggle-button",activeButton:"toggle-button-active"}};javaxt.dhtml.utils.merge(t,l);for(var o=a("div",e,t.style.panel),n=function(e,a){e.className!==t.style.activeButton&&(o.reset(),e.className=t.style.activeButton,!0===a||t.onChange&&t.onChange.apply(e,[e.innerHTML]))},s=0,r;s<t.options.length;s++)r=a("div",o,t.style.button),r.innerHTML=t.options[s],r.onclick=function(){n(this)};return o.setValue=function(e,t){for(var a=0,l;a<o.childNodes.length;a++)if(l=o.childNodes[a],l.innerText===e){n(l);break}},o.getValue=function(){for(var e=0,a;e<o.childNodes.length;e++)if(a=o.childNodes[e],a.className===t.style.activeButton)return a.innerText;return null},o.reset=function(){for(var e=0;e<o.childNodes.length;e++)o.childNodes[e].className=t.style.button},o},createDashboardItem:function(e,t){var a=javaxt.dhtml.utils.createElement,l={width:360,height:260,title:"",subtitle:"",settings:!1,waitmask:!1};javaxt.dhtml.utils.merge(t,l);var i=t.width+"",o=t.height+"";-1===i.indexOf("%")&&(i=parseInt(i)+"px"),-1===o.indexOf("%")&&(o=parseInt(o)+"px");var n=a("div",e,"dashboard-item");n.style.width=i,n.style.height=o,n.style.position="relative";var s;!0===t.settings&&(s=a("div",n,"dashboard-item-settings noselect"),s.innerHTML="<i class=\"fas fa-cog\"></i>");var r=javaxt.dhtml.utils.createTable(n),d=r.addRow().addColumn("chart-title noselect");d.innerHTML=t.title;var u=r.addRow().addColumn("chart-subtitle noselect");u.innerHTML=t.subtitle;var p=r.addRow().addColumn();p.style.height="100%",p.style.position="relative";var h;return t.waitmask&&(h=new javaxt.express.WaitMask(n)),{el:n,title:d,subtitle:u,innerDiv:p,settings:s,waitmask:h}},createGrid:function(e,t,a,l){a.innerHTML="";for(var o=[],n=javaxt.dhtml.utils.getSuggestedColumnWidths(e,10),s=e[0],r=0;r<s.length;r++){var d=n.suggestedWidths[r],u=null;"100%"===d&&1<s.length&&(u=Math.min(n.widths[r],175)),o.push({header:t?s[r]:r+1,width:d,minWidth:u,sortable:!1})}var p=document.createElement("div");p.style.height="100%",p.style.position="relative",a.appendChild(p);var h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.overflow="hidden",h.style.overflowX="auto",p.appendChild(h);var c=document.createElement("div");c.style.width="100%",c.style.height="100%",c.style.position="absolute",h.appendChild(c);var y=n.headerWidth;javaxt.dhtml.utils.onRender(h,function(){var e=javaxt.dhtml.utils.getRect(h);e.width<y&&(c.style.width=y+"px")});var m=new javaxt.dhtml.DataGrid(c,{columns:o,style:l.style.table});if(t){for(var g=[],r=1;r<e.length;r++)g.push(e[r]);m.load(g,1)}else m.load(e,1);return m},createEditor:function(e,t){var a=javaxt.dhtml.utils.createTable,l=javaxt.dhtml.utils.createElement,i=javaxt.dhtml.utils.addResizeListener,o=bluewave.utils.addTextEditor,n=bluewave.utils.createDashboardItem;t||(t={onResize:function(){},onTitleChange:function(){},onSettings:function(){}});let s=a(e);var r=s.addRow(),d;d=r.addColumn(),d.style.height="100%";var u=l("div",d,"chart-editor-options");u.style.height="100%",u.style.position="relative",u.style.overflow="hidden",u.style.overflowY="auto";var p=l("div",u);p.style.position="absolute",d=r.addColumn("chart-editor-preview"),d.style.width="100%",d.style.height="100%";var h;i(d,function(){h&&clearTimeout(h),h=setTimeout(()=>{t.onResize()},800)});var u=l("div",d);u.style.height="100%",u.style.position="relative",u.style.overflow="hidden";var c=n(u,{width:"100%",height:"100%",title:"Untitled",settings:!0});return c.el.className="",c.el.style.position="absolute",o(c.title,function(e){c.title.innerHTML=e,t.onTitleChange(e)}),c.settings.onclick=function(){t.onSettings()},{el:s,getTitle:function(){return c.title.innerHTML},setTitle:function(e){c.title.innerHTML=e},getLeftPanel:function(){return p},getChartArea:function(){return c.innerDiv},clear:function(){c.title.innerHTML="Untitled",p.innerHTML="",c.innerDiv.innerHTML=""}}},addTextEditor:function(t,a){var l=function(e){a&&a.apply(t,[e])};t.onclick=function(t){if(1!==this.childNodes[0].nodeType){t.stopPropagation();var e=this.innerText;this.innerHTML="";var a=document.createElement("input");a.className="form-input",a.type="text",a.value=e,a.onkeydown=function(e){var t=e.keyCode;(9===t||13===t)&&l(this.value)},this.appendChild(a),a.focus()}},document.body.addEventListener("click",function(a){var e=t.childNodes[0],i=a.target.className;1===e.nodeType&&"form-input"!=i&&l(e.value)})},createSlider:function(e,t,a="",l=0,o=100,n=5){for(var s=Math.ceil,r=t.findField(e),d=r.row.cloneNode(!0),u=d.childNodes,p=0;p<u.length;p++)u[p].innerHTML="";r.row.parentNode.insertBefore(d,r.row.nextSibling),d.style.height="20px";var h=document.createElement("input");u[2].appendChild(h),h.type="range",h.className="dashboard-slider",l=parseInt(l),0>l&&(l=0),o=parseInt(o),o<l&&(o=100),n=parseInt(n),1>n&&(n=1),o=s(o/n),h.setAttribute("min",l+1),h.setAttribute("max",o+1),h.onchange=function(){var e=(this.value-1)*n;r.setValue(e)};var c=javaxt.dhtml.utils.isNumber,y=javaxt.dhtml.utils.round,m=r.setValue;r.setValue=function(e){e=parseFloat(e),m(e+`${a}`),h.value=y(e/n)+1};var g=r.getValue;return r.getValue=function(){var e=parseFloat(g());return c(e)?y(e,0):0},r.row.getElementsByTagName("input")[0].addEventListener("input",function(t){var e=parseFloat(this.value);c(e)&&(0>e&&(e=0),r.setValue(e))}),h},createColorOptions:function(e,t,a){var l=t.findField(e),i=l.getButton();i.className=i.className.replace("pulldown-button-icon",""),i.style.boxShadow="none",i.setColor=function(e){i.style.backgroundColor=e},l.setValue=function(e){i.setColor(e),l.getInput().value=e,t.onChange(l,e)},l.getValue=function(){return l.getInput().value},i.onclick=function(){a&&a.apply(this,[l])}},formatNumber:function(e){if(null==e)return"";"string"!=typeof e&&(e+="");var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},getStyleEditor:function(e){return bluewave.utils.styleEditor||(bluewave.utils.styleEditor=new javaxt.dhtml.Window(document.body,{title:"Edit Style",width:400,valign:"top",modal:!1,resizable:!1,style:e.style.window})),bluewave.utils.styleEditor},getColorPalette:function(e){return!0===e?["#6699CC","#98DFAF","#FF3C38","#FF8C42","#933ed5","#bebcc1","#9DBEDE","#C6EDD3","#FF8280","#FFB586","#cda5eb","#dedde0"]:[...["#C6EDD3","#98DFAF","#FF8280","#FF3C38","#FFB586","#FF8C42","#9DBEDE","#6699CC","#999999"],...d3.schemeCategory10]},getThemeColors:function(){return{blue:"#6699CC",green:"#98DFAF",red:"#FF3C38",orange:"#FF8C42",purple:"#933ed5",grey:"#bebcc1"}},getColorGradients:function(){var e={},t=bluewave.utils.getThemeColors();for(var a in t)if(t.hasOwnProperty(a)){var l=t[a];e[a]=[l,"#f8f8f8"],"blue"==a&&(e.blue=d3.schemeBlues[7].reverse()),"red"==a&&(e.red=d3.schemeReds[7].reverse()),"green"==a&&(e.green=d3.schemeGreens[7].reverse()),"grey"==a&&(e.grey=d3.schemeGreys[7].reverse()),"purple"==a&&(e.purple=d3.schemePurples[7].reverse())}for(var o=[],n=[],s=0,r;10>=s;s++)r=s/10,o.push(d3.interpolateInferno(r)),n.push(d3.interpolatePlasma(r));return e.inferno=o.reverse(),e.plasma=n.reverse(),e.mixed=Object.values(t),e.d3=d3.schemeCategory10,e.tableau=d3.schemeTableau10,e},createColorField:function(e,t){0===arguments.length?e=document.createElement("div"):1===arguments.length&&!javaxt.dhtml.utils.isElement(e)&&(t=e,e=document.createElement("div")),t||(t={});var a={style:javaxt.dhtml.style.default};javaxt.dhtml.utils.merge(t,a);var l=new javaxt.dhtml.ComboBox(e,{style:t.style.combobox,readOnly:!0,addNewOption:!1,addNewOptionText:"Add New...",showMenuOnFocus:!0}),o;for(var n in t.colors||(t.colors=bluewave.utils.getColorGradients()),t.colors)if(t.colors.hasOwnProperty(n)){var s=t.colors[n],r=chroma.scale(s),d=document.createElement("div");d.className="form-input-menu-color";for(var u="linear-gradient(to right",h=0;h<s.length;h++){var y=javaxt.dhtml.utils.round(h/(s.length-1),2),m=r(y).css();u+=", "+m+" "+100*y+"%"}u+=")",d.style.background=u,l.add(d,JSON.stringify(s)),o||(o=n)}var g=l.setValue;return l.setValue=function(e){"string"==typeof e||e instanceof String?g(e):g(JSON.stringify(e))},l},createColorPicker:function(e,t){t||(t={}),t.style||(t.style=javaxt.dhtml.style.default);var a=t.colors;a||(a=bluewave.utils.getColorPalette(!0));var l={onChange:function(e){},setColor:function(e){},colorWheel:null,setColors:function(e){}},i=javaxt.dhtml.utils.createElement,o=javaxt.dhtml.utils.createTable(e),n;n=o.addRow().addColumn();var s=i("div");s.innerHTML="<i class=\"fas fa-check\"></i>";var r=i("div",n);r.className="color-picker-header",r.innerHTML="Theme Colors";var d=n,u=[];l.setColors=function(e){u.forEach(e=>{var t=e.parentNode;t.removeChild(e)}),u=[],e.forEach(e=>{r=i("div",d,"color-picker-option"),r.style.backgroundColor=e,r.onclick=function(){s.parentNode===this||(s.parentNode&&s.parentNode.removeChild(s),this.appendChild(s),l.onChange(new iro.Color(this.style.backgroundColor).hexString))},u.push(r)})},l.setColors(a),n=o.addRow().addColumn();var r=i("div",n,"color-picker-header noselect");r.innerHTML="Custom Colors";var p=function(){r=i("div",n,"color-picker-option"),r.onclick=function(){if(s.parentNode!==this){if(""===this.innerHTML)return s.parentNode&&s.parentNode.removeChild(s),this.appendChild(s),void l.onChange(new iro.Color(this.style.backgroundColor).hexString);if(!l.colorWheel){var e=new javaxt.dhtml.Callout(document.body,{style:{panel:"color-picker-callout-panel",arrow:"color-picker-callout-arrow"}}),t=e.getInnerDiv();t.style.padding="5px",t.style.backgroundColor="#fff";var a=new iro.ColorPicker(t,{width:280,height:280,anticlockwise:!0,borderWidth:1,borderColor:"#fff",css:{"#output":{"background-color":"$color"}}});l.colorWheel=e,l.colorWheel.getColor=function(){return a.color.hexString},a.on("color:change",function(e){var t=l.colorWheel.target;t.innerHTML="",t.style.backgroundColor=l.colorWheel.getColor()})}var i=this,n=javaxt.dhtml.utils.getRect(i),r=n.x+n.width+5,d=n.y+n.height/2;l.colorWheel.target=i,l.colorWheel.showAt(r,d,"right","middle"),l.colorWheel.onHide=function(){0<o.getElementsByClassName("color-picker-new-option").length||p()}}};var e=i("div",r,"color-picker-new-option");e.innerHTML="<i class=\"fas fa-plus\"></i>"};return p(),l},createColorPickerCallout:function(e){var t=javaxt.dhtml.utils.createElement,a=new javaxt.dhtml.Callout(document.body,{style:{panel:"color-picker-callout-panel",arrow:"color-picker-callout-arrow"}}),l=a.getInnerDiv(),i="Select Color",o=t("div",l,"window-header");o.innerHTML="<div class=\"window-title\">"+i+"</div>";var n=t("div",l,{padding:"0 15px 15px",width:"325px",backgroundColor:"#fff"}),s=javaxt.dhtml.utils.createTable(n),r=s.addRow(),d=r.addColumn(),u=bluewave.utils.createColorPicker(d,e);return a.onHide=function(){u.colorWheel&&u.colorWheel.isVisible()&&(u.colorWheel.hide(),a.show())},a.onChange=function(e){},a.setColor=function(e){u.setColor(e)},a.setColors=function(e){u.setColors(e)},u.onChange=function(e){a.onChange(e)},a},createLegend:function(e){var t=javaxt.dhtml.utils.createElement,a=t("div",e,"chart-legend");return a.addItem=function(e,l){var i=t("div",a);if(l){var o=t("div",i,"dot");o.style.backgroundColor=l}t("span",i).innerHTML=e},a.clear=function(){a.innerHTML=""},javaxt.dhtml.utils.addShowHide(a),a},resizeCanvas:function(e,t,a,l){var o=Math.sqrt,n=Math.floor,s=Math.round,r=Math.ceil,d=Math.abs,u=e.width,p=e.height;t=s(t),a=s(a);for(var h=u/t,c=p/a,y=r(h/2),m=r(c/2),g=e.getContext("2d"),b=g.getImageData(0,0,u,p),f=g.createImageData(t,a),C=b.data,x=f.data,v=0;v<a;v++)for(var k=0;k<t;k++){for(var T=4*(k+v*t),L=0,V=0,E=0,N=0,D=0,O=0,F=0,S=(v+.5)*c,A=n(v*c),B=r((v+1)*c),M=A;M<B;M++)for(var H=d(S-(M+.5))/m,P=(k+.5)*h,R=H*H,z=n(k*h),G=r((k+1)*h),I=z;I<G;I++){var W=d(P-(I+.5))/y,_=o(R+W*W);if(!(1<=_)){L=2*_*_*_-3*_*_+1;var U=4*(I+M*u);F+=L*C[U+3],E+=L,255>C[U+3]&&(L=L*C[U+3]/250),N+=L*C[U],D+=L*C[U+1],O+=L*C[U+2],V+=L}}x[T]=N/V,x[T+1]=D/V,x[T+2]=O/V,x[T+3]=F/E}!0===l?(e.width=t,e.height=a):g.clearRect(0,0,u,p),g.putImageData(f,0,0)},base64ToBlob:function(e,t){t=t||"";for(var a=1024,l=window.atob(e),o=[],n=0,s=l.length;n<s;n+=a){for(var r=l.slice(n,n+a),d=Array(r.length),u=0;u<r.length;u++)d[u]=r.charCodeAt(u);var p=new Uint8Array(d);o.push(p)}return new Blob(o,{type:t})},getPixel:function(){var e=bluewave.utils.pixel;if(!e){var t=document.createElement("canvas");t.width=1,t.height=1,e=t.toDataURL("image/png"),bluewave.utils.pixel=e}return e},parseData:function(e,t){var a=[];if(null==e||0==e.length)return a;if(!javaxt.dhtml.utils.isArray(e[0])){var l=t.sheetName,o;if(l){for(var n=0;n<e.length;n++)if(e[n].name===l){o=e[n];break}}else e[0].name&&e[0].getData&&(o=e[0]);if(!o)return a;if(e=o.getData(),null==e||0==e.length)return a}var s=[],r=0;!0===t.hasHeader?(s=e[0],r=1):e[0].forEach((e,t)=>{s.push(t+1+"")});for(var n=r,u;n<e.length;n++)u={},e[n].forEach((e,t)=>{var a=s[t],l=e;u[a]=l}),a.push(u);return a},parseCSV:function(e,t){t||(t={});var a={headers:!1,quote:"\"",separator:","};return javaxt.dhtml.utils.merge(t,a),t.headers=!1,e&&(e=e.trim()),alasql.from.CSV(e,t,null,0,null)},parseXLS:function(e,t){var a=String.fromCharCode;t||(t={});var i=alasql.utils.global.XLSX,n="binary";if(e instanceof ArrayBuffer){n="base64";for(var s="",r=0,d=10240;r<e.byteLength/d;++r)s+=a.apply(null,new Uint8Array(e.slice(r*d,r*d+d)));s+=a.apply(null,new Uint8Array(e.slice(r*d))),e=btoa(s)}var u=i.read(e,{type:n,...alasql.options.excel,...t}),p=u.SheetNames;p||(p=[]);var h=[];return p.forEach((e,t)=>{h.push({name:e,getData:function(e){e||(e={});var t={headers:!1};return javaxt.dhtml.utils.merge(e,t),e.headers=!1,bluewave.utils.parseWorkbook(this.name,u,e)}})}),h},parseWorkbook:function(e,t,a){function l(e){return e&&!1===alasql.options.casesensitive?e.toLowerCase():e}a||(a={});var o=[],n;if("undefined"==typeof a.range?n=t.Sheets[e]["!ref"]:(n=a.range,t.Sheets[e][n]&&(n=t.Sheets[e][n])),n){for(var s=n.split(":"),r=s[0].match(/[A-Z]+/)[0],d=+s[0].match(/[0-9]+/)[0],u=s[1].match(/[A-Z]+/)[0],p=+s[1].match(/[0-9]+/)[0],h={},c=alasql.utils.xlscn(r),y=alasql.utils.xlscn(u),m=c,g;m<=y;m++)g=alasql.utils.xlsnc(m),h[g]=a.headers?t.Sheets[e][g+""+d]?l(t.Sheets[e][g+""+d].v):l(g):g;a.headers&&d++;for(var b=d;b<=p;b++){var f;f=a.headers?{}:[];for(var m=c;m<=y;m++){var g=alasql.utils.xlsnc(m),C=null;t.Sheets[e][g+""+b]&&(C=t.Sheets[e][g+""+b].v),a.headers?C&&(f[h[g]]=C):f.push(C)}o.push(f)}}else o.push([]);return 0<o.length&&o[o.length-1]&&0==Object.keys(o[o.length-1]).length&&o.pop(),o}},bluewave.utils.Confirm=null;var confirm=function(e,t){"string"==typeof e||e instanceof String||(t=e),javaxt.dhtml.utils.merge(t,{title:"Confirm",text:e});var a=bluewave.utils.Confirm;if(!a){var l=document.getElementsByTagName("body")[0],i=document.createElement("div");i.className="button-div";var o=function(e,t){var l=document.createElement("input");return l.type="button",l.className="form-button",l.onclick=function(){a.result=this.result,a.close()},l.setLabel=function(e){e&&(this.name=this.value=e)},l.setValue=function(e){(!0===e||!1===e)&&(this.result=e)},l.update=function(e){e&&(this.setLabel(e.label),this.setValue(e.value))},l.setLabel(e),l.setValue(t),i.appendChild(l),l};a=bluewave.utils.Confirm=new javaxt.dhtml.Window(l,{width:450,height:150,valign:"top",modal:!0,footer:i,style:{panel:"window",header:"window-header",title:"window-title",buttonBar:"window-header-button-bar",button:"window-header-button",body:"window-body confirm-body"}}),a.leftButton=o("OK",!0),a.rightButton=o("Cancel",!1)}return a.setTitle(t.title),a.setContent(t.text.replace("\n","<p></p>")),a.leftButton.update(t.leftButton),a.rightButton.update(t.rightButton),a.result=!1,a.onClose=function(){var e=t.callback;e&&e.apply(a,[a.result])},a.show(),!1};bluewave.utils.Alert=null;var alert=function(e){null==e&&(e=""),"string"==typeof e||e instanceof String||"undefined"==typeof e.responseText||(e=0<e.responseText.length?e.responseText:e.statusText,!e&&(e="Unknown Server Error"));var t=bluewave.utils.Alert;if(!t){var a=document.getElementsByTagName("body")[0],l=document.createElement("div");l.style.width="100%",l.style.height="100%",l.style.position="relative",l.style.cursor="inherit";var i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="absolute",i.style.overflowX="hidden",i.style.cursor="inherit",l.appendChild(i),t=bluewave.utils.Alert=new javaxt.dhtml.Window(a,{width:450,height:200,valign:"top",modal:!0,title:"Alert",body:l,style:{panel:"window",header:"window-header alert-header",title:"window-title",buttonBar:"window-header-button-bar",button:"window-header-button",body:"window-body alert-body"}}),t.div=i}t.div.innerHTML=e,t.show()};
